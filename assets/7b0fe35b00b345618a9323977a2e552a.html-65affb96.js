import{_ as s,M as l,p as i,q as p,R as e,t as n,N as t,a1 as o}from"./framework-96b046e1.js";const r={},c=e("h2",{id:"场景",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#场景","aria-hidden":"true"},"#"),n(" 场景")],-1),d={href:"https://www.npmjs.com/package/gh-pages",target:"_blank",rel:"noopener noreferrer"},u=o('<p>之前就有在使用 gh-pages 这个库，但由于名字并未想到它如此强大，甚至支持发布代码到任意 git 仓库。换言之，它可以将任意本地文件发布到远端 git 仓库，而不需要自己处理各种乱七八糟的问题。</p><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题" aria-hidden="true">#</a> 问题</h2><p>首先说一下我们之前前后端分离项目的发布流程</p><ol><li>修改打包的 webpack 脚本以支持引用 cdn 上的资源（本质上是修改路径）</li><li>打包静态资源文件</li><li>找到前端静态资源发布项目，切换到指定分支</li><li>复制静态资源到特定目录</li><li><code>git commit &amp;&amp; git push</code></li><li>如果要发布 cdn 则再次对 cdn 仓库同样如此操作</li><li>通知后端发布生产环境，进行验证</li></ol><p>这其中涉及到几个重要痛点</p>',5),h={href:"https://www.zhihu.com/question/267908710",target:"_blank",rel:"noopener noreferrer"},_=e("li",null,"处理文件复制提交 git 信息，有可能操作错误，每次发布生产都是一次心理上的考验",-1),g=e("li",null,"发布失败难以快速解决，重新发布又需要手动再走一遍流程，所以有了我之前说过的发布一次要半个钟的事实",-1),b=e("h2",{id:"解决",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#解决","aria-hidden":"true"},"#"),n(" 解决")],-1),k=e("p",null,[n("不难看出，这本质上还是因为发布没有自动化带来的问题。但是，在 DevOps 还不存在的情况下，gh-pages 能够自动化下面的两步，同时，像 "),e("code",null,"create-react-app/vue-cli"),n(" 这种基于 webpack 进行高层次封装的工具提供了 "),e("code",null,"PUBLIC_PATH"),n(" 的概念，能够通过环境变量指定 "),e("code",null,"index.html"),n(" 入口引用的其他静态资源的基本路径，即便不去碰 webpack 也可以处理第一个问题了。")],-1),m={href:"https://create-react-app.dev/docs/using-the-public-folder/",target:"_blank",rel:"noopener noreferrer"},f={href:"https://cli.vuejs.org/zh/config/#publicpath",target:"_blank",rel:"noopener noreferrer"},v=o(`<p>大致过程如下</p><ol><li><p>在项目中添加依赖 <code>yarn add -D env-cmd gh-pages</code></p></li><li><p>在打包生产环境的资源时指定环境变量 <code>PUBLIC_URL=[cdn 发布后的远端基本路径]</code></p></li><li><p>添加发布 script 命令</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn build:prod &amp;&amp; yarn deploy:cdn &amp;&amp; yarn deploy:publish&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;deploy:publish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gh-pages -d [本地目录] -e [远端 git 目录] -r [远端 git 地址] -b [远端 git 分支]&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;deploy:cdn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gh-pages -d [本地目录] -e [远端 git 目录] -r [远端 git 地址] -b [远端 git 分支]&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>现在，发布生产环境只需要两个步骤</p><ol><li>运行 <code>deploy</code> 命令</li><li>通知后端发布 cdn/静态资源目录</li></ol><p>虽然仍未能解决前后端不分离的项目，但，至少解决了所有新项目的发布问题了，不是么？</p>`,5),q={href:"https://git.code.tencent.com/bingli_front/website-static",target:"_blank",rel:"noopener noreferrer"},w=e("h2",{id:"总结",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#"),n(" 总结")],-1),y=e("p",null,"还是需要擅用工具，如果能够掌握更好的工具，效率的提高和自己的痛苦程度都能有极大的改善！",-1);function x(j,B){const a=l("ExternalLinkIcon");return i(),p("div",null,[c,e("blockquote",null,[e("p",null,[e("a",d,[n("gh-pages"),t(a)])])]),u,e("ol",null,[e("li",null,[n("修改 webpack 配置，它极高的复杂度甚至产生了 "),e("a",h,[n("webpack 配置工程师"),t(a)]),n(" 这一职业岗位。")]),_,g]),b,k,e("blockquote",null,[e("p",null,[e("a",m,[n("react"),t(a)]),n(", "),e("a",f,[n("vue"),t(a)])])]),v,e("blockquote",null,[e("p",null,[n("这里有一个项目已经如此实现，可以进行参考："),e("a",q,[n("website-static"),t(a)])])]),w,y])}const N=s(r,[["render",x],["__file","7b0fe35b00b345618a9323977a2e552a.html.vue"]]);export{N as default};
