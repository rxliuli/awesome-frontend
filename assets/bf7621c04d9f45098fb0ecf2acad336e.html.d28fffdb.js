import{r as n,o as s,c as a,a as t,F as e,b as o}from"./app.21f25fa7.js";const p={},l=t("h2",{id:"场景",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#场景","aria-hidden":"true"},"#"),o(" 场景")],-1),c=t("p",null,"由于生产应用希望在有新版本时，自动为用户推送更新，所以此处便写一下如何让 electron 程序自动更新。",-1),u=t("h2",{id:"安装-npm-包",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#安装-npm-包","aria-hidden":"true"},"#"),o(" 安装 npm 包")],-1),r=t("div",{class:"language-bash ext-sh line-numbers-mode"},[t("pre",{class:"language-bash"},[t("code",null,[t("span",{class:"token builtin class-name"},"cd"),o(" apps/main/ "),t("span",{class:"token operator"},"&&"),o(),t("span",{class:"token function"},"yarn"),o(),t("span",{class:"token function"},"add"),o(" electron-updater\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br")])],-1),i=t("h2",{id:"配置-electron-builder",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#配置-electron-builder","aria-hidden":"true"},"#"),o(" 配置 electron-builder")],-1),k=o("参考: "),b={href:"https://www.electron.build/auto-update",target:"_blank",rel:"noopener noreferrer"},d=o("https://www.electron.build/auto-update"),m=t("p",null,[o("其实本质上就是配置一个网络可以访问到的静态资源目录，这里使用了一个本地的静态资源服务器，指向目录是 "),t("em",null,"apps/main/release"),o("（即打包而进程程序的目录）")],-1),h=t("div",{class:"language-json ext-json line-numbers-mode"},[t("pre",{class:"language-json"},[t("code",null,[t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token property"},'"build"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token property"},'"publish"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"["),o("\n      "),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token property"},'"provider"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"generic"'),t("span",{class:"token punctuation"},","),o("\n        "),t("span",{class:"token property"},'"url"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"http://localhost:8080/"'),o("\n      "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"]"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br")])],-1),f=t("h2",{id:"启动时检查更新",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#启动时检查更新","aria-hidden":"true"},"#"),o(" 启动时检查更新")],-1),g=t("p",null,"在主进程添加检查更新的代码，并自定义提示文案。",-1),w=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"await"),o(" autoUpdater"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"checkForUpdates"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\nautoUpdater"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addListener"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"update-downloaded"'),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),o("info"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Notification"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),o("\n    title"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"更新提醒"'),t("span",{class:"token punctuation"},","),o("\n    body"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"新版本 "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),o("info"),t("span",{class:"token punctuation"},"."),o("version"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token string"}," 已经准备好，点击立刻更新！"),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addListener"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"click"'),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n      autoUpdater"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"quitAndInstall"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"show"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br")])],-1),v=t("h2",{id:"效果",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#效果","aria-hidden":"true"},"#"),o(" 效果")],-1),y=o("现在，你可以启动一个本地静态服务器指向 "),x=t("em",null,"apps/main/release",-1),j=o("，例如 "),U={href:"https://www.npmjs.com/package/live-server",target:"_blank",rel:"noopener noreferrer"},L=o("live-server"),q=o("，然后打包一个新版本，再启动旧的程序就可以了。"),F=t("p",null,[t("img",{src:"/assets/6a33797917e34056b95238471ff0c06b.4f77e133.gif",alt:"效果"})],-1);p.render=function(o,p){const _=n("OutboundLink");return s(),a(e,null,[l,c,u,r,i,t("blockquote",null,[t("p",null,[k,t("a",b,[d,t(_)])])]),m,h,f,g,w,v,t("p",null,[y,x,j,t("a",U,[L,t(_)]),q]),F],64)};export default p;
