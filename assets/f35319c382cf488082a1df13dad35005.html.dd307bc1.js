import{r as e,o as l,c as p,a as s,d as i,F as r,e as n,b as o}from"./app.23916856.js";import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";var t="/assets/2779a9f352d849a6bb3c6fa91ca33c48.fcd942dc.svg";const d={},u=n('<h2 id="\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u573A\u666F" aria-hidden="true">#</a> \u573A\u666F</h2><p>\u5728\u6211\u4EEC\u4F7F\u7528 monorepo \u5C06\u6240\u6709\u7684\u524D\u7AEF\u9879\u76EE\u653E\u5230\u4E00\u4E2A\u9879\u76EE\u4E2D\u540E\uFF0C\u4F1A\u9762\u4E34\u5404\u79CD\u5404\u6837\u7684\u95EE\u9898\uFF0C\u5176\u4E2D\u7684\u591A\u4E2A\u901A\u7528\u6A21\u5757\u7684\u521D\u59CB\u5316\u4E5F\u4F1A\u662F\u4E00\u4E2A\u95EE\u9898\u3002</p><p><img src="'+t+`" alt="monorepo \u6A21\u5757\u4F9D\u8D56\u56FE.drawio.svg"></p><p>\u4E0B\u9762\u662F\u76EE\u524D\u5B9E\u8DF5\u8FC7\u7684\u4E00\u4E9B\u89E3\u51B3\u65B9\u6848</p><ul><li>\u589E\u91CF\u6784\u5EFA</li><li>\u6346\u7ED1\u4F9D\u8D56\u9879</li><li>\u57FA\u4E8E esbuild</li><li>\u4E0D\u6784\u5EFA dts</li></ul><h2 id="\u589E\u91CF\u6784\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u589E\u91CF\u6784\u5EFA" aria-hidden="true">#</a> \u589E\u91CF\u6784\u5EFA</h2><p>\u6BCF\u6B21\u4FEE\u6539 libs \u4E2D\u7684\u5185\u5BB9\uFF0C\u5176\u4ED6\u4EBA\u901A\u8FC7 git \u62C9\u53D6\u65F6\u90FD\u9700\u8981\u91CD\u65B0 <code>initialize</code>\uFF0C\u5982\u679C\u77E5\u9053\u5728\u54EA\u4E2A\u5305\u8FD8\u597D\uFF0C\u53EF\u4EE5\u4EC5\u8FD0\u884C\u6307\u5B9A\u5305\u7684 <code>initialize</code> \u547D\u4EE4\u3002\u5982\u679C\u4E0D\u77E5\u9053\u7684\u8BDD\uFF0C\u5219\u9700\u8981\u8FD0\u884C\u6839\u76EE\u5F55\u7684 <code>initialize</code> \u547D\u4EE4\uFF0C\u8FD9\u5176\u5B9E\u662F\u975E\u5E38\u7F13\u6162\u7684\uFF0C\u56E0\u4E3A\u5B83\u4F1A\u91CD\u65B0\u8FD0\u884C\u6240\u6709\u5305\u542B <code>intialize</code> \u547D\u4EE4\u7684 npm \u5305\uFF0C\u800C\u4E0D\u7BA1\u5B83\u4EEC\u662F\u5426\u6709\u53D8\u66F4\u3002</p><ol><li>\u51CF\u5C11 initialize \u65F6\u95F4\uFF0C\u63D0\u9AD8\u534F\u4F5C\u7684\u5F00\u53D1\u4F53\u9A8C</li><li>\u652F\u6301 ci/cd \u7F13\u5B58\u5DF2\u6784\u5EFA\u7684 libs\uFF0C\u52A0\u5FEB\u6784\u5EFA\u65F6\u95F4</li></ol><p>\u9700\u6C42</p><ul><li>\u5C3D\u53EF\u80FD\u5730\u6309\u7167\u4F9D\u8D56\u56FE\u5E76\u53D1\u6267\u884C\u547D\u4EE4\uFF0C\u5E76\u4E14\u57FA\u4E8E git \u53D8\u66F4\u5B9E\u73B0\u7F13\u5B58</li><li>\u5728\u6307\u5B9A\u6A21\u5757\u4F9D\u8D56\u7684\u6A21\u5757\u6267\u884C\u547D\u4EE4</li><li>\u5728\u6240\u6709\u5B50\u6A21\u5757\u4E2D\u6267\u884C\u547D\u4EE4</li></ul><p>\u771F\u5B9E\u9879\u76EE\u6784\u5EFA\u65F6\u95F4</p><ul><li><code>lerna run</code><ul><li>\u65B0\u9879\u76EE\u9996\u6B21\u521D\u59CB\u5316 198.54s</li><li>\u975E\u65B0\u9879\u76EE\u518D\u6B21\u521D\u59CB\u5316 90.17s</li></ul></li></ul><p>\u543E\u8F88\u5728 yarn-plugin-changed \u6A21\u5757\u4E2D\u57FA\u4E8E yarn2 \u5B9E\u73B0\u4E86\u8FD9\u4E2A\u529F\u80FD\u3002</p><h2 id="\u6346\u7ED1\u4F9D\u8D56\u9879" tabindex="-1"><a class="header-anchor" href="#\u6346\u7ED1\u4F9D\u8D56\u9879" aria-hidden="true">#</a> \u6346\u7ED1\u4F9D\u8D56\u9879</h2><p>\u52A0\u8F7D\u4E00\u4E2A\u6587\u4EF6\u603B\u6BD4\u52A0\u8F7D 100 \u4E2A\u5C0F\u6587\u4EF6\u8981\u5FEB\uFF0C\u8FD9\u4E5F\u662F\u4E3A\u4EC0\u4E48 webpack \u7B49\u5DE5\u5177\u4F1A\u5C06\u5F00\u53D1\u7684\u4EE3\u7801\u6253\u5305\uFF0Cyarn2 \u63A8\u52A8 pnp \u7684\u4E3B\u8981\u539F\u56E0\u4E4B\u4E00\u3002\u5BF9\u4E8E cli \u800C\u8A00\uFF0C\u4E5F\u662F\u4E00\u6837\u7684\u9053\u7406\uFF0C\u5C06\u4F9D\u8D56\u5C3D\u53EF\u80FD\u5730\u6253\u5305\u5230 bundle \u4E2D\u5C31\u597D\u4E86\u3002\u867D\u7136\u6253\u5305\u672C\u8EAB\u4F1A\u589E\u52A0\u4E00\u70B9\u65F6\u95F4\uFF0C\u4F46\u5728\u5176\u4ED6\u6A21\u5757\u4F7F\u7528 cli \u65F6\u5C31\u4F1A\u5FEB\u4E00\u4E9B\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>real    0m44.142s
user    0m0.122s
sys     0m0.214s
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>44.142s =&gt; 30s 438ms</p>`,17),b={href:"https://code.visualstudio.com/api/working-with-extensions/bundling-extension",target:"_blank",rel:"noopener noreferrer"},m=o("\u53C2\u8003 VSCode \u6253\u5305\u6307\u5357"),h=n(`<h2 id="\u57FA\u4E8E-esbuild" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8E-esbuild" aria-hidden="true">#</a> \u57FA\u4E8E esbuild</h2><p>rollup \u4F7F\u7528 js \u7F16\u5199\uFF0C\u5B83\u5728\u4F7F\u7528\u5FC5\u987B\u7684\u63D2\u4EF6\u4E4B\u540E\u6253\u5305\u975E\u5E38\u7F13\u6162\uFF08\u53EF\u80FD\u90E8\u5206\u8981\u5F52\u7ED3\u4E8E tsc \u672C\u8EAB\u4E5F\u975E\u5E38\u6162\uFF09\uFF0C\u800C esbuild \u5728\u5B98\u65B9\u6027\u80FD\u6D4B\u8BD5\u4E2D\u8981\u5FEB 10-100 \u500D\uFF0C\u8FD9\u4E3A\u6027\u80FD\u4F18\u5316\u63D0\u4F9B\u4E86\u4E00\u79CD\u601D\u8DEF\uFF1A\u5C06 CPU \u5BC6\u96C6\u578B\u7684\u529F\u80FD\u4F7F\u7528\u9AD8\u6027\u80FD\u7684\u8BED\u8A00\u6784\u5EFA\u3002\u5728\u4F7F\u7528 esbuild \u547D\u4EE4\u884C\u65F6\uFF0C\u57FA\u672C\u4E0A\uFF0Clib/cli \u90FD\u80FD\u5728\u6570\u767E\u6BEB\u79D2\u5185\u5B8C\u6210\u6784\u5EFA\uFF0C\u800C\u5176\u4E2D\u5B9E\u9645\u8FD0\u884C\u6784\u5EFA\u4EE3\u7801\u7684\u65F6\u95F4\u5927\u7EA6\u53EA\u6709\u51E0\u5341\u6BEB\u79D2\uFF0C\u5927\u90E8\u5206\u65F6\u95F4\u662F\u5728\u7B49\u5F85 cli \u542F\u52A8\u3002</p><p>\u4E0B\u9762\u662F\u4E00\u4E2A\u5728\u5355\u6A21\u5757\u7684\u6027\u80FD\u6D4B\u8BD5</p><p>esbuild cli</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">time</span> esbuild src/bin.ts --bundle --external:esbuild --external:@yarnpkg/cli --platform<span class="token operator">=</span>node --outfile<span class="token operator">=</span>dist/bin.js --sourcemap <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\\</span>
<span class="token function">time</span> esbuild src/index.ts --bundle --external:esbuild --external:@yarnpkg/cli --external:fs-extra --platform<span class="token operator">=</span>node --format<span class="token operator">=</span>cjs --outfile<span class="token operator">=</span>dist/index.js --sourcemap <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\\</span>
<span class="token function">time</span> esbuild src/index.ts --bundle --external:esbuild --external:@yarnpkg/cli --external:fs-extra --platform<span class="token operator">=</span>node --format<span class="token operator">=</span>esm --outfile<span class="token operator">=</span>dist/index.esm.js --sourcemap
<span class="token comment"># 0m0.244s # 15ms</span>
<span class="token comment"># 0m0.211s # 4ms</span>
<span class="token comment"># 0m0.212s # 4ms</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>esbuild base nodejs cli</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">time</span> liuli-cli build cli <span class="token comment"># 0m2.276s # 1988ms</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="\u4E0D\u6784\u5EFA-dts" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u6784\u5EFA-dts" aria-hidden="true">#</a> \u4E0D\u6784\u5EFA dts</h2><p>\u4E3A\u4EC0\u4E48\u4E0D\u6784\u5EFA dts\uFF1F</p><p>\u6784\u5EFA dts \u5F88\u6162\uFF0C\u81F3\u4E8E\u591A\u6162\u5462\uFF1F\u4E0B\u9762\u662F\u4E00\u4E2A\u6784\u5EFA cli \u7684\u65F6\u95F4\u5206\u6790</p><p>\u4E0D\u751F\u6210\u7C7B\u578B\u5B9A\u4E49</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">time</span> <span class="token function">yarn</span> build
\u221A \u6784\u5EFA cli: 141ms
\u221A \u6784\u5EFA esm: 18ms
\u221A \u6784\u5EFA cjs: 17ms
\u6784\u5EFA\u5B8C\u6210: 142ms

real    0m4.000s
user    0m0.075s
sys     0m0.138s
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u751F\u6210\u7C7B\u578B\u5B9A\u4E49</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">time</span> <span class="token function">yarn</span> build
\u221A \u6784\u5EFA cli: 3598ms
\u221A \u6784\u5EFA esm: 50ms
\u221A \u6784\u5EFA cjs: 3587ms
\u221A \u751F\u6210\u7C7B\u578B\u5B9A\u4E49: 3602ms
\u6784\u5EFA\u5B8C\u6210: 3614ms

real    0m7.763s
user    0m0.000s
sys     0m0.197s
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u751F\u6210\u7C7B\u578B\u5B9A\u4E49\u8017\u8D39\u4E86\u5927\u91CF\u7684\u65F6\u95F4\uFF0C\u4E0E\u4F7F\u7528 esbuild \u6784\u5EFA\u5B8C\u5168\u4E0D\u5728\u4E00\u4E2A\u65F6\u95F4\u91CF\u7EA7\u4E0A\u3002\u4F46\u540C\u65F6\uFF0C\u6211\u4EEC\u4E5F\u5FC5\u987B\u6CE8\u610F\u5230\uFF0Cnodejs \u82B1\u8D39\u7684\u771F\u5B9E\u65F6\u95F4\u5F88\u591A\uFF0C\u751A\u81F3\u8FDC\u8D85\u6784\u5EFA\u672C\u8EAB\uFF0C\u4E5F\u5C31\u610F\u5473\u7740\uFF0Cnodejs \u786E\u5B9E\u5B58\u5728\u6027\u80FD\u6781\u9650\u3002\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u521D\u59CB\u5316 15 \u4E2A\u6A21\u5757\u9700\u8981 30s 438ms\uFF0C\u800C\u751F\u6210 dts \u5219\u9700\u8981 44s 343ms\uFF0C\u5355\u70B9\u4F18\u5316\u5BF9\u6574\u4F53\u5DF2\u7ECF\u5F88\u96BE\u4EA7\u751F\u6570\u91CF\u7EA7\u7684\u5F71\u54CD\u4E86\u3002</p><p>\u95EE\u9898</p><ul><li>\u901A\u7528\u6A21\u5757\u4E2D\u7684 ts \u7684\u9519\u8BEF\u4F1A\u8513\u5EF6\u5230\u4E1A\u52A1\u6A21\u5757\u4E2D\uFF0C\u4E3B\u8981\u662F\u5728\u81EA\u5B9A\u4E49 <code>src/@types/</code> \u7C7B\u578B\u7684\u65F6\u5019</li></ul><h2 id="\u4E0D\u505A\u4EFB\u4F55\u6253\u5305" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u505A\u4EFB\u4F55\u6253\u5305" aria-hidden="true">#</a> \u4E0D\u505A\u4EFB\u4F55\u6253\u5305</h2><p>\u867D\u7136\u770B\u8D77\u6765\u4E0D\u53EF\u601D\u8BAE\uFF0C\u4F46\u5728 monorepo \u4E2D\uFF0C\u8BB8\u591A\u901A\u7528\u6A21\u5757\u53EF\u80FD\u5E76\u4E0D\u9700\u8981\u5728 monorepo \u4E4B\u5916\u4F7F\u7528\u5230\uFF0C\u6240\u4EE5\u5BF9\u4E8E\u6709\u4E9B\u4E0D\u9700\u8981\u53D1\u5E03\u7684\u6A21\u5757\uFF0C\u53EF\u4EE5\u4E0D\u505A\u6253\u5305\uFF0C\u800C\u662F\u76F4\u63A5\u5728 package.json \u4E2D\u6307\u5411\u672A\u6253\u5305\u7684\u5165\u53E3\u6587\u4EF6\u3002</p><p>\u4E0B\u9762\u662F\u4E00\u4E2A lib \u7684\u4E0D\u6253\u5305\u914D\u7F6E</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.ts&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5F53\u7136\uFF0C\u5B83\u4E5F\u4F1A\u5E26\u6765\u4E00\u4E9B\u526F\u4F5C\u7528\uFF0C\u4F8B\u5982</p><ul><li>\u4F7F\u7528\u8BE5\u6A21\u5757\u5FC5\u987B\u652F\u6301 ts</li><li>\u589E\u52A0\u4F9D\u8D56\u8BE5\u6A21\u5757\u7684\u7EC8\u7AEF\u7A0B\u5E8F\u7684\u6253\u5305\u65F6\u95F4</li></ul>`,23);function k(g,f){const a=e("ExternalLinkIcon");return l(),p(r,null,[u,s("blockquote",null,[s("p",null,[s("a",b,[m,i(a)])])]),h],64)}var _=c(d,[["render",k]]);export{_ as default};
