import{r as n,o as s,c as a,a as t,F as e,b as o}from"./app.2bd37eb5.js";const c={},p=t("h2",{id:"场景",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#场景","aria-hidden":"true"},"#"),o(" 场景")],-1),l=t("p",null,"由于 electron 应用分为主进程、渲染进程，所以它们之间需要通信。而 electron 本身实现了一个简单的 event emitter 通信模型，虽然能用，但并不足够好。",-1),r=o("参考: "),u={href:"https://www.electronjs.org/docs/api/ipc-renderer",target:"_blank",rel:"noopener noreferrer"},k=o("https://www.electronjs.org/docs/api/ipc-renderer"),i=t("p",null,"问题",-1),b=t("ul",null,[t("li",null,"基于字符串和约定进行通信本质上和当下前后端通信差不多，没有利用同构优势"),t("li",null,"使用起来没有任何限制，意味着很难维护（非强制性的约定基本上都很难生效）")],-1),m=t("h2",{id:"思考",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#思考","aria-hidden":"true"},"#"),o(" 思考")],-1),d=t("p",null,"那么一共 electron 进程通信有哪些情况呢？",-1),y=t("ul",null,[t("li",null,"渲染进程 => 主进程"),t("li",null,"主进程 => 渲染进程"),t("li",null,"渲染进程 => 渲染进程")],-1),w=t("p",null,[o("而其中最常用的便是 "),t("code",null,"渲染进程 => 主进程")],-1),g=o("其实吾辈也看过许多 electron 进程通信的 "),f={href:"https://www.npmjs.com/package/electron-rpc-api",target:"_blank",rel:"noopener noreferrer"},h=o("封装库"),v=o(" 或者类似场景的 rpc 实现 "),T={href:"https://www.npmjs.com/package/comlink",target:"_blank",rel:"noopener noreferrer"},P=o("comlink"),x=o("，但最终还是决定使用接口 + 主进程实现 + 渲染层根据接口生成 Client 的方式实现。"),R=t("p",null,"最终，吾辈选择了接口 + 实现类的基本模式",-1),I=t("p",null,[t("img",{src:"/assets/a744f749ef6f4652aa82f5dbcb1e22d8.e3aafe3d.svg",alt:"设计图.drawio.svg"})],-1),D=t("h2",{id:"实现渲染进程-主进程",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#实现渲染进程-主进程","aria-hidden":"true"},"#"),o(" 实现渲染进程 => 主进程")],-1),M=t("p",null,[o("首先在创建 "),t("em",null,"libs"),o(" 目录用以存放通用模块（非业务），然后创建三个模块")],-1),K=t("ul",null,[t("li",null,[t("code",null,"electron_ipc_type"),o(": 一些需要引入的类型")]),t("li",null,[t("code",null,"electron_ipc_main"),o(": 主进程封装")]),t("li",null,[t("code",null,"electron_ipc_renderer"),o(": 渲染层封装")])],-1),_=t("blockquote",null,[t("p",null,"此处使用 rollup 进行打包")],-1),A=t("p",null,"大致实现",-1),H=t("p",null,[o("electron_ipc_type: 通用的基本接口定义，必须包含一个 "),t("code",null,"namespace"),o(" 属性")],-1),C=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"interface"),o(),t("span",{class:"token class-name"},[o("BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token punctuation"},"{"),o("\n  namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br")])],-1),B=t("p",null,"electron_ipc_main: 封装主进程实现相关代码，主要保证类型安全",-1),E=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("FilteredKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token constant"},"U"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"in"),o(),t("span",{class:"token keyword"},"keyof"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),o(),t("span",{class:"token keyword"},"extends"),o(),t("span",{class:"token class-name"},[t("span",{class:"token constant"},"U")]),o(),t("span",{class:"token operator"},"?"),o(),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"never"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},"["),t("span",{class:"token keyword"},"keyof"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token doc-comment comment"},"/**\n * 转换为一个主进程可以实现的接口\n */"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("IpcMainDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"in"),o(" FilteredKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token keyword"},"void"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"("),o("\n    e"),t("span",{class:"token operator"},":"),o(" IpcMainInvokeEvent"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(" Parameters"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},"IpcMainProvider"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token keyword"},"private"),o(),t("span",{class:"token keyword"},"readonly"),o(" clazzMap "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},[o("Map"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},","),o(" object"),t("span",{class:"token operator"},">")]),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n  "),t("span",{class:"token doc-comment comment"},[o("/**\n   * 计算主进程监听的 key\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"namespace"),o("\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"method"),o("\n   * "),t("span",{class:"token keyword"},"@private"),o("\n   */")]),o("\n  "),t("span",{class:"token keyword"},"private"),o(),t("span",{class:"token keyword"},"static"),o(),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"getKey"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">")])]),t("span",{class:"token punctuation"},"("),o("namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},","),o(" method"),t("span",{class:"token operator"},":"),o(" PropertyKey"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"return"),o(" namespace "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"."'),o(),t("span",{class:"token operator"},"+"),o(" method"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"toString"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"register"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">>")])]),t("span",{class:"token punctuation"},"("),o("\n    namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},'"namespace"'),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),o("\n    api"),t("span",{class:"token operator"},":"),o(" IpcMainDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(" IpcMainDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" instance "),t("span",{class:"token operator"},"="),o(" ClassUtil"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"bindMethodThis"),t("span",{class:"token punctuation"},"("),o("api"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" methods "),t("span",{class:"token operator"},"="),o(" ClassUtil"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"scan"),t("span",{class:"token punctuation"},"("),o("instance"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    methods"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"forEach"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"("),o("method"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(" IpcMainProvider"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getKey"),t("span",{class:"token punctuation"},"("),o("namespace"),t("span",{class:"token punctuation"},","),o(" method"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      ipcMain"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"handle"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(" instance"),t("span",{class:"token punctuation"},"["),o("method"),t("span",{class:"token punctuation"},"]"),o(),t("span",{class:"token keyword"},"as"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"Register ipcMain.handle: "'),t("span",{class:"token punctuation"},","),o(" key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("clazzMap"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"set"),t("span",{class:"token punctuation"},"("),o("namespace"),t("span",{class:"token punctuation"},","),o(" instance"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"return"),o(" instance"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"unregister"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">>")])]),t("span",{class:"token punctuation"},"("),o("\n    namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},'"namespace"'),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),o("\n    api"),t("span",{class:"token operator"},":"),o(" IpcMainDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token keyword"},"void"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" methods "),t("span",{class:"token operator"},"="),o(" ClassUtil"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"scan"),t("span",{class:"token punctuation"},"("),o("api"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    methods"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"forEach"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"("),o("method"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(" IpcMainProvider"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getKey"),t("span",{class:"token punctuation"},"("),o("namespace"),t("span",{class:"token punctuation"},","),o(" method"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      ipcMain"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"removeHandler"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("clazzMap"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"delete"),t("span",{class:"token punctuation"},"("),o("namespace"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br"),t("span",{class:"line-number"},"48"),t("br"),t("span",{class:"line-number"},"49"),t("br"),t("span",{class:"line-number"},"50"),t("br"),t("span",{class:"line-number"},"51"),t("br"),t("span",{class:"line-number"},"52"),t("br"),t("span",{class:"line-number"},"53"),t("br"),t("span",{class:"line-number"},"54"),t("br")])],-1),j=t("p",null,"electron_ipc_renderer: 渲染进程",-1),F=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("FilteredKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token constant"},"U"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"in"),o(),t("span",{class:"token keyword"},"keyof"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),o(),t("span",{class:"token keyword"},"extends"),o(),t("span",{class:"token class-name"},[t("span",{class:"token constant"},"U")]),o(),t("span",{class:"token operator"},"?"),o(),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"never"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},"["),t("span",{class:"token keyword"},"keyof"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token doc-comment comment"},"/**\n * 转换为一个渲染进程可以调用的 Proxy 对象\n */"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("IpcRendererDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"in"),o(" FilteredKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token keyword"},"void"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"("),o("\n    "),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(" Parameters"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},"NotElectronEnvError"),o(),t("span",{class:"token keyword"},"extends"),o(),t("span",{class:"token class-name"},"Error"),o(),t("span",{class:"token punctuation"},"{"),t("span",{class:"token punctuation"},"}"),o("\n\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},"IpcRendererClient"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token doc-comment comment"},[o("/**\n   * 生成一个客户端实例\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"namespace"),o("\n   */")]),o("\n  "),t("span",{class:"token keyword"},"static"),o(),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"gen"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">>")])]),t("span",{class:"token punctuation"},"("),o("\n    namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},'"namespace"'),t("span",{class:"token punctuation"},"]"),o("\n  "),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(" IpcRendererDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Proxy"),t("span",{class:"token punctuation"},"("),o("Object"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"create"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),o("target"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},","),o(" api"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(" namespace "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"."'),o(),t("span",{class:"token operator"},"+"),o(" api"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"function"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n          "),t("span",{class:"token keyword"},"const"),o(" ipcRenderer "),t("span",{class:"token operator"},"="),o(" IpcRendererClient"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getRenderer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n          "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),o("ipcRenderer"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n            "),t("span",{class:"token keyword"},"throw"),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"NotElectronEnvError"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"当前你不在 electron 进程中"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n          "),t("span",{class:"token punctuation"},"}"),o("\n          "),t("span",{class:"token keyword"},"return"),o(" ipcRenderer"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"invoke"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token doc-comment comment"},"/**\n   * 获取 electron ipc renderer 实例\n   */"),o("\n  "),t("span",{class:"token keyword"},"static"),o(),t("span",{class:"token function"},"getRenderer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(" IpcRenderer "),t("span",{class:"token operator"},"|"),o(),t("span",{class:"token keyword"},"null"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),t("span",{class:"token function"},"isElectron"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token keyword"},"return"),o(" window"),t("span",{class:"token punctuation"},"."),t("span",{class:"token keyword"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"electron"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),o("ipcRenderer "),t("span",{class:"token keyword"},"as"),o(" IpcRenderer"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br")])],-1),U=t("hr",null,null,-1),z=t("p",null,"使用",-1),q=t("p",null,[o("在 apps 下创建一个模块 "),t("code",null,"shared_type"),o("，里面包含一些渲染进程与主进程之间共享的类型，下面是一个简单的示例")],-1),O=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token comment"},"// HelloDefine.ts"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"interface"),o(),t("span",{class:"token class-name"},"HelloDefine"),o(),t("span",{class:"token keyword"},"extends"),o(),t("span",{class:"token class-name"},[o("BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token string"},'"HelloApi"'),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token function"},"hello"),t("span",{class:"token punctuation"},"("),o("name"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br")])],-1),L=t("p",null,"在主进程中使用 class 实现它并注册",-1),N=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token comment"},"// main.ts"),o("\n\n"),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},"HelloApi"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token function"},"hello"),t("span",{class:"token punctuation"},"("),o("e"),t("span",{class:"token operator"},":"),o(" IpcMainInvokeEvent"),t("span",{class:"token punctuation"},","),o(" name"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"hello "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),o("name"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token keyword"},"const"),o(" ipcMainProvider "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"IpcMainProvider"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\nipcMainProvider"),t("span",{class:"token punctuation"},"."),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"register"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),o("HelloDefine"),t("span",{class:"token operator"},">")])]),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"HelloApi"'),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"HelloApi"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br")])],-1),W=t("p",null,"在渲染进程中创建客户端对象并使用",-1),$=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"const"),o(" helloApi "),t("span",{class:"token operator"},"="),o(" IpcRendererClient"),t("span",{class:"token punctuation"},"."),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"gen"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),o("HelloDefine"),t("span",{class:"token operator"},">")])]),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"HelloApi"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token keyword"},"const"),o(" str "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"await"),o(" helloApi"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"hello"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"liuli"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br")])],-1),S=t("h2",{id:"实现主进程-渲染进程",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#实现主进程-渲染进程","aria-hidden":"true"},"#"),o(" 实现主进程 => 渲染进程")],-1),G=t("p",null,"由于吾辈的 ui 层框架使用了 react，所以基于 class 的模式在此并不适用，需要使用某种变通的方式（吾辈仍然不愿意放弃将 class 作为命名空间的想法）。",-1),J=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("IpcRendererProviderDefine"),t("span",{class:"token operator"},"<"),o("\n  "),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"extends"),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o(),t("span",{class:"token operator"},"="),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o("\n"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"["),o("\n  type"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token function-variable function"},"callback"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"("),o("e"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(" Parameters"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>"),o("\n"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("IpcRendererProviderHooksDefine"),t("span",{class:"token operator"},"<"),o("\n  "),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"extends"),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o(),t("span",{class:"token operator"},"="),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o("\n"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"["),o("\n  type"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token function-variable function"},"callback"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"("),o("e"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(" Parameters"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>"),t("span",{class:"token punctuation"},","),o("\n  deps"),t("span",{class:"token operator"},"?"),t("span",{class:"token operator"},":"),o(" DependencyList\n"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token doc-comment comment"},"/**\n * 在渲染层管理提供者\n */"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},[o("IpcRendererProvider"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"any"),t("span",{class:"token operator"},">>")]),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token keyword"},"private"),o(" apiMap "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},[o("Map"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>")]),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n  "),t("span",{class:"token function"},"constructor"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"private"),o(" namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},'"namespace"'),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token function"},"register"),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),t("span",{class:"token punctuation"},"["),o("type"),t("span",{class:"token punctuation"},","),o(" callback"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(" IpcRendererProviderDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" ipcRenderer "),t("span",{class:"token operator"},"="),o(" IpcRendererClient"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getRenderer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),o("ipcRenderer "),t("span",{class:"token operator"},"==="),o(),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"warn"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"不在 electron 环境，取消注册: "'),t("span",{class:"token punctuation"},","),o(" type"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token keyword"},"return"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("namespace "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"."'),o(),t("span",{class:"token operator"},"+"),o(" type"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"IpcRendererProvider.register: "'),t("span",{class:"token punctuation"},","),o(" key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token function-variable function"},"listener"),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token punctuation"},"("),o("event"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},","),o(" id"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"string"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"try"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"IpcRendererProvider.listener: "'),t("span",{class:"token punctuation"},","),o(" event"),t("span",{class:"token punctuation"},","),o(" id"),t("span",{class:"token punctuation"},","),o(" args"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token keyword"},"const"),o(" res "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"await"),o(),t("span",{class:"token function"},"callback"),t("span",{class:"token punctuation"},"("),o("event"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),t("span",{class:"token punctuation"},"("),o("args "),t("span",{class:"token keyword"},"as"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token keyword"},"await"),o(" ipcRenderer"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"send"),t("span",{class:"token punctuation"},"("),o("id"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token keyword"},"catch"),o(),t("span",{class:"token punctuation"},"("),o("e"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token keyword"},"await"),o(" ipcRenderer"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"send"),t("span",{class:"token punctuation"},"("),o("id"),t("span",{class:"token punctuation"},","),o(" e"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n    ipcRenderer"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"on"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(" listener"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("apiMap"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"set"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(" listener"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token function"},"unregister"),t("span",{class:"token punctuation"},"("),o("type"),t("span",{class:"token operator"},":"),o(" IpcRendererProviderDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},"["),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" ipcRenderer "),t("span",{class:"token operator"},"="),o(" IpcRendererClient"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getRenderer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),o("ipcRenderer "),t("span",{class:"token operator"},"==="),o(),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"return"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("namespace "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"."'),o(),t("span",{class:"token operator"},"+"),o(" type"),t("span",{class:"token punctuation"},";"),o("\n    ipcRenderer"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"off"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("apiMap"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},"!"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("apiMap"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"delete"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n\n  "),t("span",{class:"token doc-comment comment"},[o("/**\n   * react 中的注册钩子，自动管理清理的操作\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"type"),o("\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"callback"),o("\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"deps"),o("\n   */")]),o("\n  "),t("span",{class:"token function"},"useIpcProvider"),t("span",{class:"token punctuation"},"("),o("\n    "),t("span",{class:"token operator"},"..."),t("span",{class:"token punctuation"},"["),o("type"),t("span",{class:"token punctuation"},","),o(" callback"),t("span",{class:"token punctuation"},","),o(" deps "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(" IpcRendererProviderHooksDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token function"},"useEffect"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"register"),t("span",{class:"token punctuation"},"("),o("type"),t("span",{class:"token punctuation"},","),o(" callback"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"unregister"),t("span",{class:"token punctuation"},"("),o("type"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),o(" deps"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br"),t("span",{class:"line-number"},"48"),t("br"),t("span",{class:"line-number"},"49"),t("br"),t("span",{class:"line-number"},"50"),t("br"),t("span",{class:"line-number"},"51"),t("br"),t("span",{class:"line-number"},"52"),t("br"),t("span",{class:"line-number"},"53"),t("br"),t("span",{class:"line-number"},"54"),t("br"),t("span",{class:"line-number"},"55"),t("br"),t("span",{class:"line-number"},"56"),t("br"),t("span",{class:"line-number"},"57"),t("br"),t("span",{class:"line-number"},"58"),t("br"),t("span",{class:"line-number"},"59"),t("br"),t("span",{class:"line-number"},"60"),t("br"),t("span",{class:"line-number"},"61"),t("br"),t("span",{class:"line-number"},"62"),t("br"),t("span",{class:"line-number"},"63"),t("br"),t("span",{class:"line-number"},"64"),t("br"),t("span",{class:"line-number"},"65"),t("br"),t("span",{class:"line-number"},"66"),t("br"),t("span",{class:"line-number"},"67"),t("br"),t("span",{class:"line-number"},"68"),t("br"),t("span",{class:"line-number"},"69"),t("br"),t("span",{class:"line-number"},"70"),t("br"),t("span",{class:"line-number"},"71"),t("br")])],-1),Q=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token doc-comment comment"},"/**\n * 转换为一个渲染进程可以调用的 Proxy 对象\n */"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"type"),o(),t("span",{class:"token class-name"},[o("IpcClientDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" object"),t("span",{class:"token operator"},">")]),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),o(),t("span",{class:"token keyword"},"in"),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"("),o("\n    "),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(" Parameters"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">"),o("\n  "),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"P"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token doc-comment comment"},"/**\n * 客户端\n */"),o("\n"),t("span",{class:"token keyword"},"export"),o(),t("span",{class:"token keyword"},"class"),o(),t("span",{class:"token class-name"},"IpcMainClient"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token doc-comment comment"},[o("/**\n   * 生成一个客户端实例\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"namespace"),o("\n   * "),t("span",{class:"token keyword"},"@param"),o(),t("span",{class:"token parameter"},"win"),o("\n   */")]),o("\n  "),t("span",{class:"token keyword"},"static"),o(),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"gen"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),o(),t("span",{class:"token keyword"},"extends"),o(" BaseDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token builtin"},"string"),t("span",{class:"token operator"},">>")])]),t("span",{class:"token punctuation"},"("),o("\n    namespace"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},'"namespace"'),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),o("\n    win"),t("span",{class:"token operator"},":"),o(" BrowserWindow\n  "),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(" IpcClientDefine"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Proxy"),t("span",{class:"token punctuation"},"("),o("Object"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"create"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"{"),o("\n      "),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"get"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"K"),o(),t("span",{class:"token keyword"},"extends"),o(" FunctionKeys"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token operator"},">>")])]),t("span",{class:"token punctuation"},"("),o("target"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},","),o(" api"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token constant"},"K"),t("span",{class:"token punctuation"},")"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token keyword"},"const"),o(" key "),t("span",{class:"token operator"},"="),o(" namespace "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"."'),o(),t("span",{class:"token operator"},"+"),o(" api"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"function"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n          "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},[t("span",{class:"token builtin"},"Promise"),t("span",{class:"token operator"},"<"),o("ReturnType"),t("span",{class:"token operator"},"<"),t("span",{class:"token constant"},"T"),t("span",{class:"token punctuation"},"["),t("span",{class:"token constant"},"K"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token operator"},">>")]),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"("),o("resolve"),t("span",{class:"token punctuation"},","),o(" reject"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n            "),t("span",{class:"token keyword"},"const"),o(" id "),t("span",{class:"token operator"},"="),o(" Date"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"now"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token string"},'"-"'),o(),t("span",{class:"token operator"},"+"),o(" Math"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"random"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n            ipcMain"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"once"),t("span",{class:"token punctuation"},"("),o("id"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"("),o("event"),t("span",{class:"token punctuation"},","),o(" err"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n              "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"callback: "'),t("span",{class:"token punctuation"},","),o(" err"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n              "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),o("err"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n                "),t("span",{class:"token function"},"reject"),t("span",{class:"token punctuation"},"("),o("err"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n                "),t("span",{class:"token keyword"},"return"),t("span",{class:"token punctuation"},";"),o("\n              "),t("span",{class:"token punctuation"},"}"),o("\n              "),t("span",{class:"token function"},"resolve"),t("span",{class:"token punctuation"},"("),o("res"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n            "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n            "),t("span",{class:"token builtin"},"console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"send: "'),t("span",{class:"token punctuation"},","),o(" key"),t("span",{class:"token punctuation"},","),o(" id"),t("span",{class:"token punctuation"},","),o(" args"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n            win"),t("span",{class:"token punctuation"},"."),o("webContents"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"send"),t("span",{class:"token punctuation"},"("),o("key"),t("span",{class:"token punctuation"},","),o(" id"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token operator"},"..."),t("span",{class:"token punctuation"},"("),o("args "),t("span",{class:"token keyword"},"as"),o(),t("span",{class:"token builtin"},"any"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n          "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n  "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br")])],-1),V=t("hr",null,null,-1),X=t("p",null,"使用",-1),Y=t("p",null,"在渲染进程使用 hooks 注册它",-1),Z=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"const"),o(" ipcRendererProvider "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},[o("IpcRendererProvider"),t("span",{class:"token operator"},"<"),o("HelloApiDefine"),t("span",{class:"token operator"},">")]),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"HelloApi"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\nipcRendererProvider"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"useIpcProvider"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"hello"'),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token punctuation"},"("),o("e"),t("span",{class:"token punctuation"},","),o(" name"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n  "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"hello "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),o("name"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br")])],-1),nn=t("p",null,"在主进程生成客户端实例调用它",-1),sn=t("div",{class:"language-typescript ext-ts line-numbers-mode"},[t("pre",{class:"language-typescript"},[t("code",null,[t("span",{class:"token keyword"},"const"),o(" helloApi "),t("span",{class:"token operator"},"="),o(" IpcMainClient"),t("span",{class:"token punctuation"},"."),t("span",{class:"token generic-function"},[t("span",{class:"token function"},"gen"),t("span",{class:"token generic class-name"},[t("span",{class:"token operator"},"<"),o("HelloApiDefine"),t("span",{class:"token operator"},">")])]),t("span",{class:"token punctuation"},"("),o("\n  "),t("span",{class:"token string"},'"HelloApi"'),t("span",{class:"token punctuation"},","),o("\n  "),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"BrowserWindow"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token keyword"},"const"),o(" str "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"await"),o(" helloApi"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"hello"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},'"liuli"'),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])]),t("div",{class:"line-numbers"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br")])],-1),an=t("h2",{id:"约定俗成",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#约定俗成","aria-hidden":"true"},"#"),o(" 约定俗成")],-1),tn=t("ul",null,[t("li",null,[o("在 "),t("code",null,"shared_type"),o(" 模块中的接口定义总是 "),t("code",null,"*Define"),o(" 形式，且实现的 "),t("code",null,"BaseDefine<T>"),o(" 泛型参数是 "),t("code",null,"*Api"),o(" 形式")]),t("li",null,[o("在 "),t("code",null,"main"),o(" 模块中实现的 class 总是 "),t("code",null,"*Api"),o(" 形式")]),t("li",null,[o("在 "),t("code",null,"renderer"),o(" 模块中获取的 client 实例总是 "),t("code",null,"*Api"),o(" 小写驼峰形式")]),t("li",null,[o("实现 "),t("code",null,"BaseDefine<T>"),o(" 传入的命名空间参数不应该重复")])],-1),en=t("h2",{id:"总结",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#"),o(" 总结")],-1),on=t("p",null,"electron 本身的进程通信 api 在逐渐发展，但目前仍然没有足够好用，所以吾辈不得不进行了封装。",-1);c.render=function(o,c){const cn=n("OutboundLink");return s(),a(e,null,[p,l,t("blockquote",null,[t("p",null,[r,t("a",u,[k,t(cn)])])]),i,b,m,d,y,w,t("blockquote",null,[t("p",null,[g,t("a",f,[h,t(cn)]),v,t("a",T,[P,t(cn)]),x])]),R,I,D,M,K,_,A,H,C,B,E,j,F,U,z,q,O,L,N,W,$,S,G,J,Q,V,X,Y,Z,nn,sn,an,tn,en,on],64)};export{c as default};
