import{r as n,o as s,c as a,a as e,F as t,b as l}from"./app.ba20e0a6.js";const o={},c=e("h2",{id:"前言",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),l(" 前言")],-1),p=e("p",null,[l("在 "),e("a",{href:"/p/23ec4673a06f41b59bfaf5a7da6d98db"},"基本项目搭建"),l(" 中，我们已经能够启动一个 electron 应用程序了（开发环境），现在来看如何将之打包为二进制程序便于分发给最终用户。")],-1),r=e("h2",{id:"依赖",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#依赖","aria-hidden":"true"},"#"),l(" 依赖")],-1),u={href:"https://www.electron.build/",target:"_blank",rel:"noopener noreferrer"},i=l("electron-builder"),k=l(": 打包的主要工具库，负责这个 electron 的跨平台打包工作 "),b=l("事实上，还有一些其它的打包工具，但目前还没有比它更好的，参考: "),d={href:"https://npmcompare.com/compare/electron-builder,electron-forge,electron-packager",target:"_blank",rel:"noopener noreferrer"},m=l("https://npmcompare.com/compare/electron-builder,electron-forge,electron-packager"),h=e("h2",{id:"渲染层打包",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#渲染层打包","aria-hidden":"true"},"#"),l(" 渲染层打包")],-1),g=e("p",null,"直接使用 cra 的打包工具即可，没什么大不了的，但确实存在一些注意事项",-1),f=l("因为 electron 在生产环境会从文件系统中加载静态资源，所以打包出来的静态资源必须支持相对路径，下面是常见的两个设置。 "),y=l("必须在 "),w=e("em",null,"apps/renderer/package.json",-1),x=l(" 中声明 "),v=e("code",null,'"homepage": "."',-1),_=l("，参考: "),j={href:"https://create-react-app.dev/docs/deployment/#building-for-relative-paths",target:"_blank",rel:"noopener noreferrer"},R=l("Building for Relative Paths"),L=e("li",null,[l("路由必须是 "),e("code",null,"hash"),l(" 模式")],-1),E=e("h2",{id:"主进程打包",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#主进程打包","aria-hidden":"true"},"#"),l(" 主进程打包")],-1),P=e("p",null,"electron-builder 打包需要以下几个步骤",-1),q=e("h3",{id:"更新-package-json-的一些配置",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#更新-package-json-的一些配置","aria-hidden":"true"},"#"),l(" 更新 package.json 的一些配置")],-1),B=l("使用 package.json 中的 "),U=e("code",null,"build",-1),W=l(" 字段作为配置项，参考: "),D={href:"https://www.electron.build/",target:"_blank",rel:"noopener noreferrer"},T=l("https://www.electron.build/"),M=e("li",null,[l("electron-builder 使用 "),e("code",null,"main"),l(" 字段作为启动脚本文件")],-1),S=e("li",null,[l("electron-builder 要求必须使用固定的版本号，意味着 electron 依赖需要指定为 "),e("code",null,'"electron": "10.2.0"')],-1),N=e("p",null,"下面是一个基本的配置示例",-1),O=e("div",{class:"language-json ext-json line-numbers-mode"},[e("pre",{class:"language-json"},[e("code",null,[e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token property"},'"main"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"dist/main.js"'),e("span",{class:"token punctuation"},","),l("\n  "),e("span",{class:"token property"},'"scripts"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n    "),e("span",{class:"token comment"},"// 一个非常基本的打包脚本"),l("\n    "),e("span",{class:"token property"},'"pkg"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"electron-builder"'),l("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),l("\n  "),e("span",{class:"token property"},'"devDependencies"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n    "),e("span",{class:"token property"},'"electron"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"10.2.0"'),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token property"},'"electron-builder"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"^22.9.1"'),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token comment"},"// electron 主进程实际上是 nodejs 环境，所以为了更好的开发体验，安装 nodejs 的类型定义"),l("\n    "),e("span",{class:"token property"},'"@types/node"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"^12.19.12"'),l("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),l("\n  "),e("span",{class:"token property"},'"build"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n    "),e("span",{class:"token comment"},"// 程序的唯一标识符"),l("\n    "),e("span",{class:"token property"},'"appId"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"com.rxliuli.electron_example"'),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token comment"},"// 打包出来的 exe 名字"),l("\n    "),e("span",{class:"token property"},'"productName"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"electron 示例应用"'),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token comment"},"// 打包的目录"),l("\n    "),e("span",{class:"token property"},'"directories"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n      "),e("span",{class:"token property"},'"output"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"release"'),l("\n    "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token property"},'"win"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n      "),e("span",{class:"token comment"},"// 打包目标，参考: https://www.electron.build/"),l("\n      "),e("span",{class:"token property"},'"target"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"nsis"'),e("span",{class:"token punctuation"},"]"),l("\n    "),e("span",{class:"token punctuation"},"}"),l("\n  "),e("span",{class:"token punctuation"},"}"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br")])],-1),A=e("h3",{id:"复制静态资源",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#复制静态资源","aria-hidden":"true"},"#"),l(" 复制静态资源")],-1),C=e("p",null,"现在，我们需要打包静态资源并复制到主进程模块里面",-1),F=e("ol",null,[e("li",null,[e("code",null,"cd apps/renderer"),l(" 目录")]),e("li",null,[e("code",null,"yarn build"),l(" 打包静态资源")]),e("li",null,[l("将静态资源复制到 "),e("code",null,"build/dist"),l(" 目录下")])],-1),I=e("h3",{id:"修改主进程入口文件-main-ts",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#修改主进程入口文件-main-ts","aria-hidden":"true"},"#"),l(" 修改主进程入口文件 main.ts")],-1),z=e("p",null,[l("还需要修改 "),e("em",null,"src/main.ts"),l(" 代码，主要修改 BrowserWindow 对象载入的 "),e("code",null,"url"),l(" 地址")],-1),G=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),l(),e("span",{class:"token punctuation"},"{"),l(" app"),e("span",{class:"token punctuation"},","),l(" BrowserWindow "),e("span",{class:"token punctuation"},"}"),l(),e("span",{class:"token keyword"},"from"),l(),e("span",{class:"token string"},'"electron"'),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token keyword"},"import"),l(" path "),e("span",{class:"token operator"},"="),l(),e("span",{class:"token keyword"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"path"'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token keyword"},"import"),l(),e("span",{class:"token punctuation"},"{"),l(),e("span",{class:"token constant"},"URL"),l(),e("span",{class:"token punctuation"},"}"),l(),e("span",{class:"token keyword"},"from"),l(),e("span",{class:"token string"},'"url"'),e("span",{class:"token punctuation"},";"),l("\n\n"),e("span",{class:"token keyword"},"async"),l(),e("span",{class:"token keyword"},"function"),l(),e("span",{class:"token function"},"createMainWindow"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),l(),e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token comment"},"// 创建新的 electron 窗口"),l("\n  "),e("span",{class:"token keyword"},"const"),l(" mainWindow "),e("span",{class:"token operator"},"="),l(),e("span",{class:"token keyword"},"new"),l(),e("span",{class:"token class-name"},"BrowserWindow"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n  "),e("span",{class:"token comment"},"// 载入生产环境的 url"),l("\n  "),e("span",{class:"token keyword"},"await"),l(" mainWindow"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"loadURL"),e("span",{class:"token punctuation"},"("),l("\n    "),e("span",{class:"token keyword"},"new"),l(),e("span",{class:"token class-name"},[e("span",{class:"token constant"},"URL")]),e("span",{class:"token punctuation"},"("),l("path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"join"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token string"},'"./build/index.html"'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"."),l("href\n  "),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n\n"),e("span",{class:"token comment"},"// 其他代码..."),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br")])],-1),H=e("blockquote",null,[e("p",null,[l("注意，这个 url 路径是相对于打包后的 "),e("code",null,"dist/main.js"),l(" 而言的，因为最终打包的程序运行时的相对路径也是这样。")])],-1),J=e("h3",{id:"打包主进程的-exe-程序",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#打包主进程的-exe-程序","aria-hidden":"true"},"#"),l(" 打包主进程的 exe 程序")],-1),K=l("因为 electron-builder 需要下载基本的 electron 程序，所以请提前设置好透明代理，如果不知道它是什么，参考: "),Q={href:"https://github.com/rxliuli/haoel.github.io#7-%E9%80%8F%E6%98%8E%E7%BD%91%E5%85%B3",target:"_blank",rel:"noopener noreferrer"},V=l("透明网关"),X=l("，"),Y={href:"http://www.proxifier.com/",target:"_blank",rel:"noopener noreferrer"},Z=l("Proxifier"),$=e("ol",null,[e("li",null,[l("使用 "),e("code",null,"yarn compile"),l(" 编译 ts 代码")]),e("li",null,[l("使用 "),e("code",null,"yarn pkg"),l(" 打包 electron 应用")])],-1),nn=e("p",null,[l("现在，我们应该可以在 "),e("em",null,"apps/main/release/win-unpacked"),l(" 下看到 exe 程序，双击它即可看到之前在开发环境的首页了。")],-1),sn=l("参考: "),an={href:"https://github.com/rxliuli/electron_example/tree/85d398fc2c6ba6c918ad9641dbb5d8bae2d4216b/apps/main",target:"_blank",rel:"noopener noreferrer"},en=l("https://github.com/rxliuli/electron_example/tree/85d398fc2c6ba6c918ad9641dbb5d8bae2d4216b/apps/main"),tn=e("h2",{id:"优化打包",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#优化打包","aria-hidden":"true"},"#"),l(" 优化打包")],-1),ln=e("p",null,"虽然打包已经实现，但确实还存在一些问题",-1),on=e("ul",null,[e("li",null,"打包脚本仍然不是一键的"),e("li",null,"不能兼容开发、生产环境")],-1),cn=e("p",null,"下面我们来解决这两个问题",-1),pn=e("h3",{id:"实现一键打包二进制程序",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#实现一键打包二进制程序","aria-hidden":"true"},"#"),l(" 实现一键打包二进制程序")],-1),rn=e("p",null,"使用 gulp 复制渲染层的静态资源",-1),un=e("p",null,[l("1、添加 gulp 相关依赖 "),e("code",null,"yarn add -D gulp ts-node @types/gulp fs-extra @types/fs-extra")],-1),kn=e("ul",null,[e("li",null,[e("code",null,"gulp @types/gulp"),l(": gulp 核心依赖")]),e("li",null,[e("code",null,"ts-node"),l(": 使用 ts 编写 gulp 脚本必须的依赖")]),e("li",null,[e("code",null,"fs-extra @types/fs-extra"),l(": fs 的扩展增强，使用 Promise 包装异步 api")])],-1),bn=e("p",null,"2、添加 gulp 脚本文件",-1),dn=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),l(),e("span",{class:"token punctuation"},"{"),l(" copy"),e("span",{class:"token punctuation"},","),l(" remove "),e("span",{class:"token punctuation"},"}"),l(),e("span",{class:"token keyword"},"from"),l(),e("span",{class:"token string"},'"fs-extra"'),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token keyword"},"import"),l(),e("span",{class:"token operator"},"*"),l(),e("span",{class:"token keyword"},"as"),l(" path "),e("span",{class:"token keyword"},"from"),l(),e("span",{class:"token string"},'"path"'),e("span",{class:"token punctuation"},";"),l("\n\n"),e("span",{class:"token keyword"},"async"),l(),e("span",{class:"token keyword"},"function"),l(),e("span",{class:"token function"},"copyByMap"),e("span",{class:"token punctuation"},"("),l("copyMap"),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"["),e("span",{class:"token builtin"},"string"),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token builtin"},"string"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},"["),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")"),l(),e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token keyword"},"await"),l(),e("span",{class:"token builtin"},"Promise"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"all"),e("span",{class:"token punctuation"},"("),l("\n    copyMap"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"map"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"async"),l(),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"["),l("src"),e("span",{class:"token punctuation"},","),l(" destDir"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")"),l(),e("span",{class:"token operator"},"=>"),l(),e("span",{class:"token punctuation"},"{"),l("\n      "),e("span",{class:"token keyword"},"const"),l(" srcPath "),e("span",{class:"token operator"},"="),l(" path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"resolve"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(" src"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n      "),e("span",{class:"token keyword"},"const"),l(" destPath "),e("span",{class:"token operator"},"="),l(" path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"resolve"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(" destDir"),e("span",{class:"token punctuation"},","),l(" path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"basename"),e("span",{class:"token punctuation"},"("),l("srcPath"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n      "),e("span",{class:"token keyword"},"await"),l(),e("span",{class:"token function"},"copy"),e("span",{class:"token punctuation"},"("),l("srcPath"),e("span",{class:"token punctuation"},","),l(" destPath"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n    "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),l("\n  "),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n\n"),e("span",{class:"token doc-comment comment"},"/**\n * 清理最终生成目录\n */"),l("\n"),e("span",{class:"token keyword"},"export"),l(),e("span",{class:"token keyword"},"async"),l(),e("span",{class:"token keyword"},"function"),l(),e("span",{class:"token function"},"clean"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),l(),e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token keyword"},"await"),l(),e("span",{class:"token function"},"remove"),e("span",{class:"token punctuation"},"("),l("path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"resolve"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token string"},'"dist"'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n  "),e("span",{class:"token keyword"},"await"),l(),e("span",{class:"token function"},"remove"),e("span",{class:"token punctuation"},"("),l("path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"resolve"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token string"},'"release"'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n\n"),e("span",{class:"token doc-comment comment"},"/**\n * 复制一些资源到 dist 目录中\n */"),l("\n"),e("span",{class:"token keyword"},"export"),l(),e("span",{class:"token keyword"},"async"),l(),e("span",{class:"token keyword"},"function"),l(),e("span",{class:"token function"},"copyStatic"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),l(),e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token keyword"},"await"),l(),e("span",{class:"token function"},"copyByMap"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"["),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"../renderer/build"'),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token string"},'"dist/"'),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br")])],-1),mn=e("p",null,"3、添加 npm script",-1),hn=e("blockquote",null,[e("p",null,"注: lerna 的好处之一就是可以运行其它模块的 npm script。")],-1),gn=e("div",{class:"language-json ext-json line-numbers-mode"},[e("pre",{class:"language-json"},[e("code",null,[e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token property"},'"scripts"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n    "),e("span",{class:"token comment"},"// 打包渲染层的静态资源"),l("\n    "),e("span",{class:"token property"},'"build:web"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"lerna run --scope renderer build"'),e("span",{class:"token punctuation"},","),l("\n    "),e("span",{class:"token comment"},"// 打包渲染层的静态资源之后复制然后使用 electron-builder 打包 exe 程序"),l("\n    "),e("span",{class:"token property"},'"pkg"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"gulp clean && yarn compile && yarn build:web && gulp copyStatic && electron-builder"'),l("\n  "),e("span",{class:"token punctuation"},"}"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br")])],-1),fn=e("p",null,"4、修改 tsconfig.json",-1),yn=e("p",null,[l("此时在 "),e("em",null,"apps/main"),l(" 模块根目录下也有 ts 文件了，所以 tsc 翻译代码会将它们也包含进去，但实际上不需要。")],-1),wn=e("div",{class:"language-json ext-json line-numbers-mode"},[e("pre",{class:"language-json"},[e("code",null,[e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token property"},'"include"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"src"'),e("span",{class:"token punctuation"},"]"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br")])],-1),xn=e("p",null,"现在，我们可以使用一个命令打包 exe 程序了。",-1),vn=l("参考: "),_n={href:"https://github.com/rxliuli/electron_example/blob/3dacff5dc0/apps/main/package.json",target:"_blank",rel:"noopener noreferrer"},jn=l("https://github.com/rxliuli/electron_example/blob/3dacff5dc0/apps/main/package.json"),Rn=e("h3",{id:"使用环境变量来兼容开发、生产环境",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#使用环境变量来兼容开发、生产环境","aria-hidden":"true"},"#"),l(" 使用环境变量来兼容开发、生产环境")],-1),Ln=l("解决方案简单来说就一句话：使用环境变量指定开发环境的 URL。 这里使用 "),En={href:"https://github.com/toddbluhm/env-cmd",target:"_blank",rel:"noopener noreferrer"},Pn=l("env-cmd"),qn=l(" 来跨平台写入环境变量（不使用 "),Bn={href:"https://github.com/motdotla/dotenv",target:"_blank",rel:"noopener noreferrer"},Un=l("dotenv"),Wn=l(" 的原因在于自定义环境使用起来有点麻烦，不像 env-cmd 那么直观），而另一个 "),Dn={href:"https://github.com/kentcdodds/cross-env",target:"_blank",rel:"noopener noreferrer"},Tn=l("cross-env"),Mn=l(" 并未提供管理环境变量的解决方案。下面说一下使用 env-cmd 的步骤"),Sn=e("ol",null,[e("li",null,[e("p",null,[l("安装依赖 "),e("code",null,"yarn add -D env-cmd")])]),e("li",null,[e("p",null,[l("添加配置文件 "),e("em",null,".env-cmdrc.json"),l(" 基本上是一个键值映射文件，键是环境，值对象是环境变量")]),e("div",{class:"language-json ext-json line-numbers-mode"},[e("pre",{class:"language-json"},[e("code",null,[e("span",{class:"token punctuation"},"{"),l("\n  "),e("span",{class:"token property"},'"dev"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token punctuation"},"{"),l("\n    "),e("span",{class:"token property"},'"ELECTRON_START_URL"'),e("span",{class:"token operator"},":"),l(),e("span",{class:"token string"},'"http://localhost:3000/"'),l("\n  "),e("span",{class:"token punctuation"},"}"),l("\n"),e("span",{class:"token punctuation"},"}"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br")])])]),e("li",null,[e("p",null,[l("在 "),e("code",null,"dev:electron"),l(" 命令之前设定环境变量 "),e("code",null,"env-cmd -e dev electron ./dist/main.js")])]),e("li",null,[e("p",null,[l("修改 "),e("em",null,"src/main.ts"),l(" 读取环境变量")]),e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"await"),l(" mainWindow"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"loadURL"),e("span",{class:"token punctuation"},"("),l("\n  process"),e("span",{class:"token punctuation"},"."),l("env"),e("span",{class:"token punctuation"},"."),e("span",{class:"token constant"},"ELECTRON_START_URL"),l(),e("span",{class:"token operator"},"||"),l("\n    path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"join"),e("span",{class:"token punctuation"},"("),l("__dirname"),e("span",{class:"token punctuation"},","),l(),e("span",{class:"token string"},'"./build/index.html"'),e("span",{class:"token punctuation"},")"),l("\n"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),l("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br")])])])],-1),Nn=e("p",null,[l("现在，像 "),e("a",{href:"/p/23ec4673a06f41b59bfaf5a7da6d98db"},"基本项目搭建"),l(" 中 "),e("strong",null,[l("更新 "),e("em",null,"package.json"),l(" 添加几个 npm script")]),l(" 说的那样启动开发环境就会显示开发环境的页面，打包后显示的则是打包后的静态资源。")],-1),On=e("p",null,[e("img",{src:"/assets/866c4124afe04289b88972507b3f6743.e5494014.png",alt:"效果"})],-1),An=l("参考: "),Cn={href:"https://github.com/rxliuli/electron_example/blob/f8b4f94435/apps/main/.env-cmdrc.json",target:"_blank",rel:"noopener noreferrer"},Fn=l("https://github.com/rxliuli/electron_example/blob/f8b4f94435/apps/main/.env-cmdrc.json"),In=e("h2",{id:"总结",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#"),l(" 总结")],-1),zn=e("p",null,[l("虽然 electron-builder 已经足够好用了，但它仍然不能解决 electron 项目工程上的问题，所以这里结合了 "),e("code",null,"lerna/gulp/env-cmd"),l(" 打包。")],-1);o.render=function(l,o){const Gn=n("OutboundLink");return s(),a(t,null,[c,p,r,e("ul",null,[e("li",null,[e("a",u,[i,e(Gn)]),k,e("blockquote",null,[e("p",null,[b,e("a",d,[m,e(Gn)])])])])]),h,g,e("ul",null,[e("li",null,[f,e("ul",null,[e("li",null,[y,w,x,v,_,e("a",j,[R,e(Gn)])]),L])])]),E,P,q,e("ol",null,[e("li",null,[B,U,W,e("a",D,[T,e(Gn)])]),M,S]),N,O,A,C,F,I,z,G,H,J,e("blockquote",null,[e("p",null,[K,e("a",Q,[V,e(Gn)]),X,e("a",Y,[Z,e(Gn)])])]),$,nn,e("blockquote",null,[e("p",null,[sn,e("a",an,[en,e(Gn)])])]),tn,ln,on,cn,pn,rn,un,kn,bn,dn,mn,hn,gn,fn,yn,wn,xn,e("blockquote",null,[e("p",null,[vn,e("a",_n,[jn,e(Gn)])])]),Rn,e("p",null,[Ln,e("a",En,[Pn,e(Gn)]),qn,e("a",Bn,[Un,e(Gn)]),Wn,e("a",Dn,[Tn,e(Gn)]),Mn]),Sn,Nn,On,e("blockquote",null,[e("p",null,[An,e("a",Cn,[Fn,e(Gn)])])]),In,zn],64)};export{o as default};
