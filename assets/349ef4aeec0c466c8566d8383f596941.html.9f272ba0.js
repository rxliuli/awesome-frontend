import{r as n,o as s,c as a,a as e,F as t,b as o}from"./app.969c9eca.js";const l={},p=e("h2",{id:"场景",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#场景","aria-hidden":"true"},"#"),o(" 场景")],-1),c=e("p",null,"graphql 提供前后端一致的 api 架构元数据，同时通过请求合并、按需获取加快 web 与后端交互的性能。",-1),r=e("h2",{id:"结合-ts-使用",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#结合-ts-使用","aria-hidden":"true"},"#"),o(" 结合 ts 使用")],-1),u=e("p",null,"基本思路",-1),i=e("ol",null,[e("li",null,[o("扫描代码中所有 "),e("code",null,"gql"),o(" 字符串")]),e("li",null,[o("获取到代码中 "),e("code",null,"graphql"),o(" 字符串然后生成类型定义")]),e("li",null,"使用这些类型定义")],-1),k=e("h2",{id:"使用步骤",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#使用步骤","aria-hidden":"true"},"#"),o(" 使用步骤")],-1),b=e("blockquote",null,[e("p",null,"以下使用 github api@v4 进行演示")],-1),m=e("p",null,"获取后端的元数据",-1),d=e("div",{class:"language-bash ext-sh line-numbers-mode"},[e("pre",{class:"language-bash"},[e("code",null,[e("span",{class:"token function"},"curl"),o(" https://docs.github.com/public/schema.docs.graphql "),e("span",{class:"token operator"},">"),o(" schema.graphql\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br")])],-1),g=e("p",null,"安装基础 sdk",-1),h=e("div",{class:"language-bash ext-sh line-numbers-mode"},[e("pre",{class:"language-bash"},[e("code",null,[e("span",{class:"token function"},"pnpm"),o(" i @apollo/client graphql\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br")])],-1),y=e("p",null,"安装代码生成器相关依赖",-1),w=e("ul",null,[e("li",null,[e("code",null,"@graphql-codegen/cli"),o(" 基础 cli")]),e("li",null,[e("code",null,"@graphql-codegen/typescript"),o(" ts 插件")]),e("li",null,[e("code",null,"@graphql-codegen/typescript-operations"),o(" ts 操作生成插件")]),e("li",null,[e("code",null,"@graphql-codegen/near-operation-file-preset"),o(" ts 预设配置")])],-1),f=e("p",null,[o("创建配置 "),e("em",null,"codegen.yml")],-1),q=e("div",{class:"language-yaml ext-yml line-numbers-mode"},[e("pre",{class:"language-yaml"},[e("code",null,[e("span",{class:"token key atrule"},"overwrite"),e("span",{class:"token punctuation"},":"),o(),e("span",{class:"token boolean important"},"true"),o("\n"),e("span",{class:"token key atrule"},"schema"),e("span",{class:"token punctuation"},":"),o(),e("span",{class:"token string"},'"schema.graphql"'),o("\n"),e("span",{class:"token key atrule"},"generates"),e("span",{class:"token punctuation"},":"),o("\n  "),e("span",{class:"token key atrule"},"./src/graphql.gql.ts"),e("span",{class:"token punctuation"},":"),o("\n    "),e("span",{class:"token key atrule"},"plugins"),e("span",{class:"token punctuation"},":"),o("\n      "),e("span",{class:"token punctuation"},"-"),o(" typescript\n  "),e("span",{class:"token key atrule"},"./"),e("span",{class:"token punctuation"},":"),o("\n    "),e("span",{class:"token key atrule"},"documents"),e("span",{class:"token punctuation"},":"),o("\n      "),e("span",{class:"token punctuation"},"-"),o(),e("span",{class:"token string"},'"src/**/*.ts"'),o("\n      "),e("span",{class:"token punctuation"},"-"),o(),e("span",{class:"token string"},'"!src/**/*.gql.ts"'),o("\n    "),e("span",{class:"token key atrule"},"preset"),e("span",{class:"token punctuation"},":"),o(" near"),e("span",{class:"token punctuation"},"-"),o("operation"),e("span",{class:"token punctuation"},"-"),o("file\n    "),e("span",{class:"token key atrule"},"presetConfig"),e("span",{class:"token punctuation"},":"),o("\n      "),e("span",{class:"token key atrule"},"baseTypesPath"),e("span",{class:"token punctuation"},":"),o(" ./src/graphql.gql.ts\n      "),e("span",{class:"token key atrule"},"extension"),e("span",{class:"token punctuation"},":"),o(" .gql.ts\n    "),e("span",{class:"token key atrule"},"plugins"),e("span",{class:"token punctuation"},":"),o("\n      "),e("span",{class:"token punctuation"},"-"),o(" typescript"),e("span",{class:"token punctuation"},"-"),o("operations\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br")])],-1),x=e("p",null,"在代码中添加一些 graphql 变量",-1),v=e("blockquote",null,[e("p",null,[o("tip: 在非 react 项目中，请从 "),e("code",null,"@apollo/client/core"),o(" 导入所有非 react 的内容。")])],-1),S=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" gql "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"@apollo/client"'),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"const"),o(" findRepoStar "),e("span",{class:"token operator"},"="),o(" gql"),e("span",{class:"token template-string"},[e("span",{class:"token template-punctuation string"},"`"),e("span",{class:"token string"},"\n  query findRepoStar($name: String!, $owner: String!) {\n    repository(name: $name, owner: $owner) {\n      name\n      stargazerCount\n    }\n  }\n"),e("span",{class:"token template-punctuation string"},"`")]),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"const"),o(" findRepo "),e("span",{class:"token operator"},"="),o(" gql"),e("span",{class:"token template-string"},[e("span",{class:"token template-punctuation string"},"`"),e("span",{class:"token string"},"\n  query findRepo($name: String!, $owner: String!) {\n    repository(name: $name, owner: $owner) {\n      name\n    }\n  }\n"),e("span",{class:"token template-punctuation string"},"`")]),e("span",{class:"token punctuation"},";"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br")])],-1),C=e("p",null,"使用 cli 生成类型定义",-1),_=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[o("pnpm graphql"),e("span",{class:"token operator"},"-"),o("codegen "),e("span",{class:"token operator"},"--"),o("config codegen"),e("span",{class:"token punctuation"},"."),o("yml\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br")])],-1),j=e("p",null,"生成结果大致如下，基本上就是参数和结果类型",-1),Q=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token operator"},"*"),o(),e("span",{class:"token keyword"},"as"),o(" Types "),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"../graphql.gql"'),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"type"),o(),e("span",{class:"token class-name"},"FindRepoStarQueryVariables"),o(),e("span",{class:"token operator"},"="),o(" Types"),e("span",{class:"token punctuation"},"."),o("Exact"),e("span",{class:"token operator"},"<"),e("span",{class:"token punctuation"},"{"),o("\n  name"),e("span",{class:"token operator"},":"),o(" Types"),e("span",{class:"token punctuation"},"."),o("Scalars"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"String"'),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},";"),o("\n  owner"),e("span",{class:"token operator"},":"),o(" Types"),e("span",{class:"token punctuation"},"."),o("Scalars"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"String"'),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token operator"},">"),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"type"),o(),e("span",{class:"token class-name"},"FindRepoStarQuery"),o(),e("span",{class:"token operator"},"="),o(),e("span",{class:"token punctuation"},"{"),o("\n  __typename"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"Query"'),e("span",{class:"token punctuation"},";"),o("\n  repository"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o("\n    "),e("span",{class:"token operator"},"|"),o(),e("span",{class:"token punctuation"},"{"),o(" __typename"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"Repository"'),e("span",{class:"token punctuation"},";"),o(" name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"string"),e("span",{class:"token punctuation"},";"),o(" stargazerCount"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"number"),o(),e("span",{class:"token punctuation"},"}"),o("\n    "),e("span",{class:"token operator"},"|"),o(),e("span",{class:"token keyword"},"null"),o("\n    "),e("span",{class:"token operator"},"|"),o(),e("span",{class:"token keyword"},"undefined"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"type"),o(),e("span",{class:"token class-name"},"FindRepoQueryVariables"),o(),e("span",{class:"token operator"},"="),o(" Types"),e("span",{class:"token punctuation"},"."),o("Exact"),e("span",{class:"token operator"},"<"),e("span",{class:"token punctuation"},"{"),o("\n  name"),e("span",{class:"token operator"},":"),o(" Types"),e("span",{class:"token punctuation"},"."),o("Scalars"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"String"'),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},";"),o("\n  owner"),e("span",{class:"token operator"},":"),o(" Types"),e("span",{class:"token punctuation"},"."),o("Scalars"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"String"'),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token operator"},">"),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"type"),o(),e("span",{class:"token class-name"},"FindRepoQuery"),o(),e("span",{class:"token operator"},"="),o(),e("span",{class:"token punctuation"},"{"),o("\n  __typename"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"Query"'),e("span",{class:"token punctuation"},";"),o("\n  repository"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o(" __typename"),e("span",{class:"token operator"},"?"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"Repository"'),e("span",{class:"token punctuation"},";"),o(" name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"string"),o(),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token operator"},"|"),o(),e("span",{class:"token keyword"},"null"),o(),e("span",{class:"token operator"},"|"),o(),e("span",{class:"token keyword"},"undefined"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},";"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br")])],-1),R=e("p",null,"我们可以这样使用它",-1),T=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"const"),o(" res "),e("span",{class:"token operator"},"="),o(),e("span",{class:"token keyword"},"await"),o(" client"),e("span",{class:"token punctuation"},"."),e("span",{class:"token generic-function"},[e("span",{class:"token function"},"query"),e("span",{class:"token generic class-name"},[e("span",{class:"token operator"},"<"),o("FindRepoStarQuery"),e("span",{class:"token punctuation"},","),o(" FindRepoStarQueryVariables"),e("span",{class:"token operator"},">")])]),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),o("\n  query"),e("span",{class:"token operator"},":"),o(" findRepoStar"),e("span",{class:"token punctuation"},","),o("\n  variables"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n    name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"liuli-tools"'),e("span",{class:"token punctuation"},","),o("\n    owner"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"rxliuli"'),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"res: "'),e("span",{class:"token punctuation"},","),o(" res"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br")])],-1),E=e("h2",{id:"jetbrains-ide-支持",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#jetbrains-ide-支持","aria-hidden":"true"},"#"),o(" Jetbrains IDE 支持")],-1),L=o("安装插件 "),$={href:"https://plugins.jetbrains.com/plugin/8097",target:"_blank",rel:"noopener noreferrer"},F=o("JS GraphQL"),G=e("li",null,[e("p",null,[o("创建 graphql 基础配置文件 "),e("em",null,".graphqlconfig")]),e("div",{class:"language-json ext-json line-numbers-mode"},[e("pre",{class:"language-json"},[e("code",null,[e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token property"},'"name"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"github GraphQL Schema"'),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token property"},'"schemaPath"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"schema.graphql"'),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token property"},'"extensions"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n    "),e("span",{class:"token property"},'"endpoints"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n      "),e("span",{class:"token property"},'"Default GraphQL Endpoint"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n        "),e("span",{class:"token property"},'"url"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"https://api.github.com/graphql"'),e("span",{class:"token punctuation"},","),o("\n        "),e("span",{class:"token property"},'"headers"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n          "),e("span",{class:"token property"},'"user-agent"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"JS GraphQL"'),e("span",{class:"token punctuation"},","),o("\n          "),e("span",{class:"token property"},'"Authorization"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"bearer ${env:GITHUB_TOKEN}"'),o("\n        "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n        "),e("span",{class:"token property"},'"introspect"'),e("span",{class:"token operator"},":"),o(),e("span",{class:"token boolean"},"false"),o("\n      "),e("span",{class:"token punctuation"},"}"),o("\n    "),e("span",{class:"token punctuation"},"}"),o("\n  "),e("span",{class:"token punctuation"},"}"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br")])])],-1),P=e("li",null,[e("p",null,[o("最终效果 "),e("img",{src:"/assets/994d6f1aee71444b983d982bf216fd1c.c68b9849.png",alt:"1635317727128"})])],-1),M=e("h2",{id:"vscode-支持",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#vscode-支持","aria-hidden":"true"},"#"),o(" VSCode 支持")],-1),z=o("安装插件 "),A={href:"https://marketplace.visualstudio.com/items?itemName=apollographql.vscode-apollo",target:"_blank",rel:"noopener noreferrer"},V=o("Apollo GraphQL"),W=e("li",null,[e("p",null,[o("添加配置 "),e("em",null,"apollo.config.js")]),e("div",{class:"language-javascript ext-js line-numbers-mode"},[e("pre",{class:"language-javascript"},[e("code",null,[o("module"),e("span",{class:"token punctuation"},"."),o("exports "),e("span",{class:"token operator"},"="),o(),e("span",{class:"token punctuation"},"{"),o("\n  client"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n    service"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token punctuation"},"{"),o("\n      name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"github GraphQL Schema"'),e("span",{class:"token punctuation"},","),o("\n      localSchemaFile"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"./schema.graphql"'),e("span",{class:"token punctuation"},","),o("\n    "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},";"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br")])])],-1),I=e("li",null,[e("p",null,[o("最终效果 "),e("img",{src:"/assets/6dd72b1c51114beebd38ba4f65ca4976.fe204b88.png",alt:"1635316734084"})])],-1),J=e("h2",{id:"集成到-vite-rollup",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#集成到-vite-rollup","aria-hidden":"true"},"#"),o(" 集成到 vite/rollup")],-1),N=e("p",null,[o("关于为什么要将自动生成作为 vite 插件集成，之前在 "),e("a",{href:"/p/3e5d207024444d3e9f8395c1302d6201"},"是否需要将 cli 工具集成到构建工具中"),o(" 中已经说明了。")],-1),D={href:"https://github.com/danielwaltz/vite-plugin-graphql-codegen",target:"_blank",rel:"noopener noreferrer"},O=o("vite-plugin-graphql-codegen"),B=o(" 监视模式实际上有 bug，所以自行维护一个 rollup 插件"),H=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" Plugin "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"vite"'),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" CodegenContext"),e("span",{class:"token punctuation"},","),o(" generate"),e("span",{class:"token punctuation"},","),o(" loadContext "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"@graphql-codegen/cli"'),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"async"),o(),e("span",{class:"token keyword"},"function"),o(),e("span",{class:"token function"},"codegen"),e("span",{class:"token punctuation"},"("),o("watch"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"boolean"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token keyword"},"const"),o(" codegenContext "),e("span",{class:"token operator"},"="),o(),e("span",{class:"token keyword"},"await"),o(),e("span",{class:"token function"},"loadContext"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  codegenContext"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"updateConfig"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),o(" watch "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token keyword"},"try"),o(),e("span",{class:"token punctuation"},"{"),o("\n    "),e("span",{class:"token keyword"},"await"),o(),e("span",{class:"token function"},"generate"),e("span",{class:"token punctuation"},"("),o("codegenContext"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"catch"),o(),e("span",{class:"token punctuation"},"("),o("error"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n    "),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"Something went wrong."'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token punctuation"},"}"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"function"),o(),e("span",{class:"token function"},"graphQLCodegen"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token operator"},":"),o(" Plugin "),e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token keyword"},"let"),o(" codegenContext"),e("span",{class:"token operator"},":"),o(" CodegenContext"),e("span",{class:"token punctuation"},";"),o("\n\n  "),e("span",{class:"token keyword"},"return"),o(),e("span",{class:"token punctuation"},"{"),o("\n    name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"rollup-plugin-graphql-codegen"'),e("span",{class:"token punctuation"},","),o("\n    "),e("span",{class:"token keyword"},"async"),o(),e("span",{class:"token function"},"buildStart"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n      "),e("span",{class:"token comment"},"// noinspection ES6MissingAwait"),o("\n      "),e("span",{class:"token function"},"codegen"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),o("meta"),e("span",{class:"token punctuation"},"."),o("watchMode"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n    "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br")])],-1),K=e("p",null,[o("这里其实还可以使用 "),e("code",null,"worker_threads"),o(" 尝试多线程加速")],-1),U=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" Plugin "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"vite"'),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" generate"),e("span",{class:"token punctuation"},","),o(" loadContext "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"@graphql-codegen/cli"'),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" isMainThread"),e("span",{class:"token punctuation"},","),o(" parentPort"),e("span",{class:"token punctuation"},","),o(" Worker "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"worker_threads"'),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"import"),o(),e("span",{class:"token punctuation"},"{"),o(" expose"),e("span",{class:"token punctuation"},","),o(" wrap "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"comlink"'),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token keyword"},"import"),o(" nodeEndpoint "),e("span",{class:"token keyword"},"from"),o(),e("span",{class:"token string"},'"comlink/dist/umd/node-adapter"'),e("span",{class:"token punctuation"},";"),o("\n\n"),e("span",{class:"token keyword"},"async"),o(),e("span",{class:"token keyword"},"function"),o(),e("span",{class:"token function"},"codegen"),e("span",{class:"token punctuation"},"("),o("watch"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"boolean"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token keyword"},"const"),o(" codegenContext "),e("span",{class:"token operator"},"="),o(),e("span",{class:"token keyword"},"await"),o(),e("span",{class:"token function"},"loadContext"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  codegenContext"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"updateConfig"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),o(" watch "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token keyword"},"try"),o(),e("span",{class:"token punctuation"},"{"),o("\n    "),e("span",{class:"token keyword"},"await"),o(),e("span",{class:"token function"},"generate"),e("span",{class:"token punctuation"},"("),o("codegenContext"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"catch"),o(),e("span",{class:"token punctuation"},"("),o("error"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n    "),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"Something went wrong."'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n  "),e("span",{class:"token punctuation"},"}"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n\n"),e("span",{class:"token keyword"},"if"),o(),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"!"),o("isMainThread"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token function"},"expose"),e("span",{class:"token punctuation"},"("),o("codegen"),e("span",{class:"token punctuation"},","),o(),e("span",{class:"token function"},"nodeEndpoint"),e("span",{class:"token punctuation"},"("),o("parentPort"),e("span",{class:"token operator"},"!"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n\n"),e("span",{class:"token keyword"},"export"),o(),e("span",{class:"token keyword"},"function"),o(),e("span",{class:"token function"},"graphQLCodegen"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token operator"},":"),o(" Plugin "),e("span",{class:"token punctuation"},"{"),o("\n  "),e("span",{class:"token keyword"},"return"),o(),e("span",{class:"token punctuation"},"{"),o("\n    name"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token string"},'"rollup-plugin-graphql-codegen"'),e("span",{class:"token punctuation"},","),o("\n    "),e("span",{class:"token keyword"},"async"),o(),e("span",{class:"token function"},"buildStart"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token punctuation"},"{"),o("\n      "),e("span",{class:"token keyword"},"const"),o(" worker "),e("span",{class:"token operator"},"="),o(),e("span",{class:"token keyword"},"new"),o(),e("span",{class:"token class-name"},"Worker"),e("span",{class:"token punctuation"},"("),o("__filename"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n      "),e("span",{class:"token keyword"},"try"),o(),e("span",{class:"token punctuation"},"{"),o("\n        "),e("span",{class:"token keyword"},"const"),o(" codegenWorker "),e("span",{class:"token operator"},"="),o(" wrap"),e("span",{class:"token operator"},"<"),e("span",{class:"token punctuation"},"("),o("watch"),e("span",{class:"token operator"},":"),o(),e("span",{class:"token builtin"},"boolean"),e("span",{class:"token punctuation"},")"),o(),e("span",{class:"token operator"},"=>"),o(),e("span",{class:"token keyword"},"void"),e("span",{class:"token operator"},">"),e("span",{class:"token punctuation"},"("),o("\n          "),e("span",{class:"token function"},"nodeEndpoint"),e("span",{class:"token punctuation"},"("),o("worker"),e("span",{class:"token punctuation"},")"),o("\n        "),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n        "),e("span",{class:"token comment"},"// noinspection ES6MissingAwait"),o("\n        "),e("span",{class:"token function"},"codegenWorker"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),o("meta"),e("span",{class:"token punctuation"},"."),o("watchMode"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n      "),e("span",{class:"token punctuation"},"}"),o(),e("span",{class:"token keyword"},"finally"),o(),e("span",{class:"token punctuation"},"{"),o("\n        worker"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"unref"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),o("\n      "),e("span",{class:"token punctuation"},"}"),o("\n    "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),o("\n  "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},";"),o("\n"),e("span",{class:"token punctuation"},"}"),o("\n")])]),e("div",{class:"line-numbers"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br"),e("span",{class:"line-number"},"28"),e("br"),e("span",{class:"line-number"},"29"),e("br"),e("span",{class:"line-number"},"30"),e("br"),e("span",{class:"line-number"},"31"),e("br"),e("span",{class:"line-number"},"32"),e("br"),e("span",{class:"line-number"},"33"),e("br"),e("span",{class:"line-number"},"34"),e("br"),e("span",{class:"line-number"},"35"),e("br"),e("span",{class:"line-number"},"36"),e("br"),e("span",{class:"line-number"},"37"),e("br")])],-1),X=o("已发布至 "),Y={href:"https://www.npmjs.com/package/@liuli-util/rollup-plugin-graphql-codegen",target:"_blank",rel:"noopener noreferrer"},Z=o("@liuli-util/rollup-plugin-graphql-codegen"),nn=e("h2",{id:"安装-chrome-插件",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#安装-chrome-插件","aria-hidden":"true"},"#"),o(" 安装 chrome 插件")],-1),sn={href:"https://chrome.google.com/webstore/detail/ndlbedplllcgconngcnfmkadhokfaaln/",target:"_blank",rel:"noopener noreferrer"},an=o("GraphQL Network Inspector"),en=e("p",null,[e("img",{src:"/assets/c25e1b9401594c90b73adab510439194.055e85c6.png",alt:"1637290440947"})],-1),tn=e("h2",{id:"参考",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#参考","aria-hidden":"true"},"#"),o(" 参考")],-1),on={href:"https://www.apollographql.com/docs/react/get-started/",target:"_blank",rel:"noopener noreferrer"},ln=o("@apollo/client"),pn={href:"https://jimkyndemeyer.github.io/js-graphql-intellij-plugin/",target:"_blank",rel:"noopener noreferrer"},cn=o("jetbrains ide 使用 graphql"),rn={href:"https://www.graphql-code-generator.com/",target:"_blank",rel:"noopener noreferrer"},un=o("graphql 代码生成器"),kn=e("h2",{id:"其他方案",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#其他方案","aria-hidden":"true"},"#"),o(" 其他方案？")],-1),bn=e("ul",null,[e("li",null,[o("使用 rollup 插件 "),e("code",null,"@rollup/plugin-graphql"),o(" 直接将 "),e("code",null,".graphql"),o(" 文件视为可导入的 es 模块 -- 主要问题是要处理相关工具的兼容性，主要包括 jest/eslint。")])],-1);l.render=function(o,l){const mn=n("OutboundLink");return s(),a(t,null,[p,c,r,u,i,k,b,m,d,g,h,y,w,f,q,x,v,S,C,_,j,Q,R,T,E,e("ol",null,[e("li",null,[e("p",null,[L,e("a",$,[F,e(mn)])])]),G,P]),M,e("ol",null,[e("li",null,[e("p",null,[z,e("a",A,[V,e(mn)])])]),W,I]),J,N,e("blockquote",null,[e("p",null,[e("a",D,[O,e(mn)]),B])]),H,K,U,e("blockquote",null,[e("p",null,[X,e("a",Y,[Z,e(mn)])])]),nn,e("blockquote",null,[e("p",null,[e("a",sn,[an,e(mn)])])]),en,tn,e("ul",null,[e("li",null,[e("a",on,[ln,e(mn)])]),e("li",null,[e("a",pn,[cn,e(mn)])]),e("li",null,[e("a",rn,[un,e(mn)])])]),kn,bn],64)};export{l as default};
