import{r as A,o as l,c as n,a as e,F as a,b as s}from"./app.7980cf23.js";const r={},i=e("h2",{id:"问题",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#问题","aria-hidden":"true"},"#"),s(" 问题")],-1),p=e("p",null,"吾辈写了一个简单的示例代码说明目前遇到的困境（虽然是 react 不过框架之间原理是相通的），其实就是组件内的代码在某个权限下才会执行，但是又依赖于组件内的一些状态，如何将这些代码分割到不同的地方（例如不同的文件）便于之后的维护。",-1),t=e("p",null,[e("img",{src:"/assets/4f0213cf7c854ff09fec8f390e494b69.74b459bd.png",alt:"7e69d69a9157f9880390cfb28f9a12eb.png"})],-1),d=e("p",null,[e("img",{src:"data:image/png;base64,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",alt:"b96ed8f9915d324a238c66ea6f2cc520.png"})],-1),c=e("p",null,[e("img",{src:"/assets/b767efcaea3749cdb9b2a7d39f8d1433.31e55059.png",alt:"8e51e2ceb7bf034de3b0a01f796172e7.png"})],-1),u=e("p",null,"这个例子里面有两种角色，normal/vip，普通用户可以试用 vip 的功能，vip 角色不能出现普通用户的试用功能，从功能上看很好实现，但问题在于如何将这些互相耦合的代码分割，理想情况是在进入页面初始化时就确定要加载的 state/methods 了。",-1),o=e("p",null,[e("img",{src:"/assets/037bae5c50d745a497ac2654454c57a6.330745fd.png",alt:"2535ac9cc61e98e49aacc7417570e845.png"})],-1),g=e("p",null,"虽然这里只有两种角色，但吾辈丝毫不怀疑真实场景会有更多，当然真实场景是角色下面还有权限，某些东西是角色所属的（只要是这个角色就一定有），而有些则是权限所属（必须拥有某个权限）",-1),I=e("p",null,"那么，有什么优雅的方式将这种与权限相关但相互存在关联的代码（state/method）分离么？",-1),h=s("具体代码在："),b={href:"https://github.com/rxliuli/admin-man-sys/blob/f97534e94e/src/pages/index/permission/REditable.tsx",target:"_blank",rel:"noopener noreferrer"},Q=s("https://github.com/rxliuli/admin-man-sys/blob/f97534e94e/src/pages/index/permission/REditable.tsx"),m=e("hr",null,null,-1),f=e("p",null,"下面使用类的形式实现了代码分割，但似乎并没有更加简单。。。",-1),V=e("p",null,[e("img",{src:"/assets/2d1bf90a96074de998e50109074c16a3.a5bddb8b.png",alt:"a825c2280b163c296a4979bd9606828d.png"})],-1),G=s("具体代码在："),x={href:"https://github.com/rxliuli/admin-man-sys/blob/master/src/pages/index/permission/REditableWrapper.tsx",target:"_blank",rel:"noopener noreferrer"},C=s("https://github.com/rxliuli/admin-man-sys/blob/master/src/pages/index/permission/REditableWrapper.tsx"),w=e("h2",{id:"讨论",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#讨论","aria-hidden":"true"},"#"),s(" 讨论")],-1),B=e("ul",null,[e("li",null,[e("p",null,"Meathill"),e("ol",null,[e("li",null,"大体上，你只需要考虑界面上有区分即可。代码拆分价值不大，毕竟压缩后最多十几 K，对加载速度和响应速度的影响都微乎其微，但是要花时间设计代码结构。"),e("li",null,"非得要做，可以考虑 webpack lazyload 功能，分拆模块为不同文件。")])]),e("li",null,[e("p",null,"我: 一个主要的渴求是将这些代码按照权限分割出去，便于之后的维护，代码大小本质上不存在什么问题（倒不如说分割之后再打包反而更大）")]),e("li",null,[e("p",null,"Meathill: 按照权限分割代码未必有利日后的维护。可以好好读一下《重构》和《设计模式》。")]),e("li",null,[e("p",null,"我: 这种诉求并非完全来源于前端，而是来自于经理（后端）的想法。。。"),e("blockquote",null,[e("p",null,"经理：我理解应该是根据图片是什么类型确定进哪个类型的 “实现 “, 这里是什么设计？为什么感觉糊里糊涂的 经理：前端把公共代码抽象出来不行吗？时间不够也应该按这个思路做，稍微有复制的代码，至少设计没问题 经理：列表页就知道是什么类型的图片不是吗？为什么这里不能决定进哪个实现？ 我：现在是从官网跳转时加的 query 参数 bizType 确定类型，然后基于此拿到对应的权限（permission）列表，然后根据是否有权限控制元素的显示隐藏，本身逻辑代码还是一起的 经理：这个不是个很典型的面向对象的多态吗？是什么原因不能抽象和做两个实现？ 我：那是后端万物皆类的情况，前端组件化场景下要考虑的是组件分割之后，代码复用、通信带来的麻烦是否过高 经理：这是做到什么程度的问题，目标是流程复用，实现独立，新增一个类型不能漏实现。就像后台那个答题新增一种题型还要记着去改统计那里，太蠢了")]),e("p",null,"最终实在不行我们或许只能采用 mixin 这种不是很好的解决方案了。。")]),e("li",null,[e("p",null,"Meathill: 其实吧，HTML/CSS 的崛起已经证明了 “面向对象的多态” 在 UI 开发方面天生不足。但是这一点展开讲太复杂。推荐你和你的经理看看尤雨溪（Vue 的作者）前阵子的演讲《State of Components》，了解一下 React Hooks 和 Vue Composition API，再来看这个问题，可能看法就变了。")]),e("li",null,[e("p",null,"我: 最终我找到了一个用【类】的形式去分割操作逻辑的方法，不过感觉文件真的多太多了，而且还要想办法在 vue 里重写。。。（参考上面的补充）")]),e("li",null,[e("p",null,"我: 好吧，现在吾辈已然实用了 react hooks，确信 hooks 是一种更好的解决方案！")])],-1),k=e("h2",{id:"解决思路",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#解决思路","aria-hidden":"true"},"#"),s(" 解决思路")],-1),q=e("ul",null,[e("li",null,"mixin 混入"),e("li",null,"使用高阶组件"),e("li",null,"使用 hooks 封装逻辑")],-1),J=e("h2",{id:"解决方案",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#解决方案","aria-hidden":"true"},"#"),s(" 解决方案")],-1),v=e("p",null,[s("经过 hooks 的实践，吾辈发现 hooks 实在太适合封装 UI 和逻辑代码了。 因为 hooks 几乎能做到所有组件能做到的事情，同时没有组件那么"),e("strong",null,"重"),s("，事实上，很久以来 react 都允许写一个函数返回 UI，但这仅适用于无状态组件，对于有状态的组件，之前只能使用类组件。但现在 hooks 却极大增强了函数的能力，甚至为函数开了后门 -- 所有 "),e("code",null,"use"),s(" 开头的函数均被认为是自定义 hooks。")],-1);r.render=function(s,r){const W=A("OutboundLink");return l(),n(a,null,[i,p,t,d,c,u,o,g,I,e("p",null,[h,e("a",b,[Q,e(W)])]),m,f,V,e("p",null,[G,e("a",x,[C,e(W)])]),w,B,k,q,J,v],64)};export{r as default};
