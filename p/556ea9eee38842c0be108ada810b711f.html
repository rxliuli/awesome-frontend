<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Awesome Frontend</title><meta name="description" content="这是一个自以为是的前端技术选择和推荐网站"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.23">
    <link rel="modulepreload" href="/assets/app.55fed6f8.js"><link rel="modulepreload" href="/assets/556ea9eee38842c0be108ada810b711f.html.be242ead.js"><link rel="modulepreload" href="/assets/556ea9eee38842c0be108ada810b711f.html.f2526d82.js">
    <link rel="stylesheet" href="/assets/style.ab239ff8.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/" class=""><!----><span class="site-name">Awesome Frontend</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rxliuli/wiki" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rxliuli/wiki" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">其他</p><ul class=""><li><!--[--><p class="sidebar-item">Git</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/b63ba6ff31c049f8a6703ce7022a79e6.html" class="nav-link sidebar-item" aria-label="Git 常用命令"><!--[--><!--]--> Git 常用命令 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/1db27f8106cc48218641490889f37793.html" class="nav-link sidebar-item" aria-label="Git 设置和取消代理"><!--[--><!--]--> Git 设置和取消代理 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">IDEA</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/b80cb42493004bb482cc1762d5e90c9e.html" class="nav-link sidebar-item" aria-label="IDEA 设置 Git-Bash 为默认 Terminal"><!--[--><!--]--> IDEA 设置 Git-Bash 为默认 Terminal <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/4196df6a040f4c0aa3016547d895bf6b.html" class="nav-link sidebar-item" aria-label="WebStorm 使用技巧"><!--[--><!--]--> WebStorm 使用技巧 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">VSCode</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/522048077c1343b79eb9f42640c02bd0.html" class="nav-link sidebar-item" aria-label="VSCode 搭建 markdown 写作环境"><!--[--><!--]--> VSCode 搭建 markdown 写作环境 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/a305aafaac2b4ee8b9fa2f97898f1eea.html" class="nav-link sidebar-item" aria-label="VSCode 与 WebStorm 横向对比"><!--[--><!--]--> VSCode 与 WebStorm 横向对比 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">Windows</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/d25cb9b2f5d446ce852b03c15e8fb8e5.html" class="nav-link sidebar-item" aria-label="Windows 上的工具清单"><!--[--><!--]--> Windows 上的工具清单 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/7f94aa8c6eff4eaaab7004361fe0614f.html" class="nav-link sidebar-item" aria-label="Windows 使用技巧"><!--[--><!--]--> Windows 使用技巧 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/cdeb250dd4e04b168bc608cc9a118697.html" class="nav-link sidebar-item" aria-label="优化 Google Chrome 的使用体验"><!--[--><!--]--> 优化 Google Chrome 的使用体验 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">工具</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/e46fa2086bea40d087ac8bd8e30d02ae.html" class="nav-link sidebar-item" aria-label="使用 VSCode 在 Markdown 中绘图"><!--[--><!--]--> 使用 VSCode 在 Markdown 中绘图 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">杂谈</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/0391e85b82f5465cb1ab0ff962a50ea7.html" class="nav-link sidebar-item" aria-label="为什么要用现代前端"><!--[--><!--]--> 为什么要用现代前端 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/1a01dae8fd924bb6a0d5f4ee7f6847cf.html" class="nav-link sidebar-item" aria-label="前端与后端的选择（个人理解）"><!--[--><!--]--> 前端与后端的选择（个人理解） <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">前端</p><ul class=""><li><!--[--><p class="sidebar-item">Electron</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/624ba71c53634ea591de1338111da396.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-简介"><!--[--><!--]--> electron 开发经验之谈系列-简介 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/76393a60949c47c7add910df0206734c.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-渲染、主进程通信"><!--[--><!--]--> electron 开发经验之谈系列-渲染、主进程通信 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/0a4259c97ca440d1b5375f4e21eaaace.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-electron 自定义协议"><!--[--><!--]--> electron 开发经验之谈系列-electron 自定义协议 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/5ce7d75fe2dc46838b49f9e5e14ac738.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-在渲染、主进程间共享数据"><!--[--><!--]--> electron 开发经验之谈系列-在渲染、主进程间共享数据 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/6edf2cfaf7ec46f0bfb659d8c7246c52.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-技术栈简介及选择"><!--[--><!--]--> electron 开发经验之谈系列-技术栈简介及选择 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/c68829779f5449d0afe0e67806dc7fc1.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-常见问题"><!--[--><!--]--> electron 开发经验之谈系列-常见问题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/33dd9a3fccaf4666b04935237f885772.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-使用 electron-builder 打包"><!--[--><!--]--> electron 开发经验之谈系列-使用 electron-builder 打包 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/23ec4673a06f41b59bfaf5a7da6d98db.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-基本项目搭建"><!--[--><!--]--> electron 开发经验之谈系列-基本项目搭建 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/5cc9156517484576a64b4d253ae28af8.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-开发环境优化"><!--[--><!--]--> electron 开发经验之谈系列-开发环境优化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/85f539d2cc4e4ae89093df537111cec8.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-自定义窗口顶栏"><!--[--><!--]--> electron 开发经验之谈系列-自定义窗口顶栏 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/bf7621c04d9f45098fb0ecf2acad336e.html" class="nav-link sidebar-item" aria-label="electron 开发经验之谈系列-自动更新"><!--[--><!--]--> electron 开发经验之谈系列-自动更新 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">React</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/e76cfaa1f454465bbeb62006b53b2c78.html" class="nav-link sidebar-item" aria-label="基本的国际化 i18next"><!--[--><!--]--> 基本的国际化 i18next <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">TypeScript</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/f1d61494bcdd4cad8f7dbf73c908c884.html" class="nav-link sidebar-item" aria-label="TypeScript 技巧总结"><!--[--><!--]--> TypeScript 技巧总结 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/d101451820354652a932ffe820d9d1c5.html" class="nav-link sidebar-item" aria-label="TypeScript 类型编程"><!--[--><!--]--> TypeScript 类型编程 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/03ee7047ae3c4203b0c4c4ebfd6d7bd9.html" class="nav-link sidebar-item" aria-label="JavaScript =&gt; TypeScript 迁移体验"><!--[--><!--]--> JavaScript =&gt; TypeScript 迁移体验 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item active">工程化</p><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="yarn2 使用"><!--[--><!--]--> yarn2 使用 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#动机" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="动机"><!--[--><!--]--> 动机 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#如何使用类似于-lerna-run-exec-之类的命令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何使用类似于 lerna run/exec 之类的命令"><!--[--><!--]--> 如何使用类似于 lerna run/exec 之类的命令 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#如何像-lerna-publish-更新所有模块的版本" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何像 lerna publish 更新所有模块的版本"><!--[--><!--]--> 如何像 lerna publish 更新所有模块的版本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#如果包含-cli-子模块怎么办" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如果包含 cli 子模块怎么办？"><!--[--><!--]--> 如果包含 cli 子模块怎么办？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#编写插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="编写插件"><!--[--><!--]--> 编写插件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#问题" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="问题"><!--[--><!--]--> 问题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#其他优点" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="其他优点"><!--[--><!--]--> 其他优点 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#编写插件之后应该怎么在本地测试" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="编写插件之后应该怎么在本地测试？"><!--[--><!--]--> 编写插件之后应该怎么在本地测试？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-workspace-有办法包含一个不在-workspace-管理的子目录么" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn workspace 有办法包含一个不在 workspace 管理的子目录么？"><!--[--><!--]--> yarn workspace 有办法包含一个不在 workspace 管理的子目录么？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#npmrc-yarnrc-yml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="npmrc =&gt; yarnrc.yml"><!--[--><!--]--> npmrc =&gt; yarnrc.yml <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn2-在-monorepo-中根模块无法直接-import-子模块的-yarn-插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn2 在 monorepo 中根模块无法直接 import 子模块的 yarn 插件"><!--[--><!--]--> yarn2 在 monorepo 中根模块无法直接 import 子模块的 yarn 插件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-插件打包后在-bundles-yarnpkg-下而非我们的组织名下面" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn 插件打包后在 bundles/@yarnpkg 下而非我们的组织名下面"><!--[--><!--]--> yarn 插件打包后在 bundles/@yarnpkg 下而非我们的组织名下面 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#获取系统信息" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="获取系统信息"><!--[--><!--]--> 获取系统信息 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#使用-yarn-patch-制作本地补丁包" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用 yarn patch 制作本地补丁包"><!--[--><!--]--> 使用 yarn patch 制作本地补丁包 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-pack-会忽略-gitignore" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn pack 会忽略 .gitignore"><!--[--><!--]--> yarn pack 会忽略 .gitignore <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#运行初始化命令但卡死了" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="运行初始化命令但卡死了"><!--[--><!--]--> 运行初始化命令但卡死了 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#如何更新所有依赖的版本为最新" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何更新所有依赖的版本为最新"><!--[--><!--]--> 如何更新所有依赖的版本为最新 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-插件没有版本的概念" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn 插件没有版本的概念"><!--[--><!--]--> yarn 插件没有版本的概念 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-workspaces-的-topological-dev-参数未生效" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn workspaces 的 --topological-dev 参数未生效"><!--[--><!--]--> yarn workspaces 的 --topological-dev 参数未生效 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-install-link-step-很慢" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn install link step 很慢"><!--[--><!--]--> yarn install link step 很慢 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#如何在-monorepo-中执行指定脚本" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何在 monorepo 中执行指定脚本"><!--[--><!--]--> 如何在 monorepo 中执行指定脚本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#yarn-如何全局安装-monorepo-项目中包含私有模块依赖的-cli-模块" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yarn 如何全局安装 monorepo 项目中包含私有模块依赖的 cli 模块"><!--[--><!--]--> yarn 如何全局安装 monorepo 项目中包含私有模块依赖的 cli 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/p/556ea9eee38842c0be108ada810b711f.html#nodejs-性能是否真的很烂" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="nodejs 性能是否真的很烂"><!--[--><!--]--> nodejs 性能是否真的很烂 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/p/d9b7ea8e049b42628164019b16f762d2.html" class="nav-link sidebar-item" aria-label="lerna 使用踩坑"><!--[--><!--]--> lerna 使用踩坑 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html" class="nav-link sidebar-item" aria-label="实践 lerna monorepo"><!--[--><!--]--> 实践 lerna monorepo <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/d984e195f1b1469ca49ff364374ce3d8.html" class="nav-link sidebar-item" aria-label="关于前端组件通信的一些理解"><!--[--><!--]--> 关于前端组件通信的一些理解 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/0171bcd51b1343d6a9ad54557d567c46.html" class="nav-link sidebar-item" aria-label="在现代前端项目中使用 Worker"><!--[--><!--]--> 在现代前端项目中使用 Worker <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/b8a95af9134a488e9d94463bd18768c9.html" class="nav-link sidebar-item" aria-label="编写兼容 nodejs/浏览器的库"><!--[--><!--]--> 编写兼容 nodejs/浏览器的库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/6be33848912b4a63bd0bfebe0e99fda1.html" class="nav-link sidebar-item" aria-label="React 根据状态动态化功能的一些思考"><!--[--><!--]--> React 根据状态动态化功能的一些思考 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/3b1502f22ad645b5a6521b39b145e560.html" class="nav-link sidebar-item" aria-label="使用 React Context 结合 EventEmitter"><!--[--><!--]--> 使用 React Context 结合 EventEmitter <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/7b0fe35b00b345618a9323977a2e552a.html" class="nav-link sidebar-item" aria-label="使用 gh-pages 发布前端项目"><!--[--><!--]--> 使用 gh-pages 发布前端项目 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">框架</p><ul class="sidebar-sub-items"><li><!--[--><a href="/p/664f86d038744a01894699e368cc2708.html" class="nav-link sidebar-item" aria-label="前端资源管理"><!--[--><!--]--> 前端资源管理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/c55a6470683e498f92ba05d7ff710b3a.html" class="nav-link sidebar-item" aria-label="react 通用列表组件封装"><!--[--><!--]--> react 通用列表组件封装 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/8c57648407fa4b72ac30c3a61b1c1fef.html" class="nav-link sidebar-item" aria-label="在传统项目中使用 babel 编译 ES6"><!--[--><!--]--> 在传统项目中使用 babel 编译 ES6 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/p/d7c0007c37f24d4cb4a3c5a1dbb9d3d6.html" class="nav-link sidebar-item" aria-label="前端如何根据不同权限分割逻辑代码？（state/method）"><!--[--><!--]--> 前端如何根据不同权限分割逻辑代码？（state/method） <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="动机" tabindex="-1"><a class="header-anchor" href="#动机" aria-hidden="true">#</a> 动机</h2><ul><li>不再同时使用两个 monorepo 管理工具，或者说将 monorepo 功能整合到 yarn 里（新的依赖管理工具 npm7/pnpm/rush 都是这样干的），专注于增强 yarn（yarn.build 是一个不错的例子）</li><li>使用 yarn2 逐渐发展的生态（yarn1 基本没什么更新了）</li><li>lerna 的高级功能不太好用，主要是 <code>lerna run</code> 不支持缓存导致每次重新构建会很烦 -- 考虑使用 ultra 支持，但 yarn2 似乎有插件可以支持，参考: <a href="https://github.com/yarnpkg/berry/issues/2374" target="_blank" rel="noopener noreferrer">https://github.com/yarnpkg/berry/issues/2374<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li>yarn2 不需要使用 <code>lerna clean -y &amp;&amp; lerna bootstrap</code> 来将动态构建的 cli 写入到 <code>node_modules/.bin</code>，它查找 <code>cli</code> 的方式发生了变化（完全动态化），参考 <a href="https://yarnpkg.com/getting-started/migration#call-binaries-using-yarn-run-rather-than-node_modulesbin" target="_blank" rel="noopener noreferrer">https://yarnpkg.com/getting-started/migration#call-binaries-using-yarn-run-rather-than-node_modulesbin<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a><ul><li>该优化大约能将每个 cli 的构建时间从 40s 降低至 10s 内，之前大部分时间都是写入 <code>node_modules/.bin</code></li></ul></li></ul><h2 id="如何使用类似于-lerna-run-exec-之类的命令" tabindex="-1"><a class="header-anchor" href="#如何使用类似于-lerna-run-exec-之类的命令" aria-hidden="true">#</a> 如何使用类似于 lerna run/exec 之类的命令</h2><ol><li>使用 workspaces 插件 <code>yarn plugin import @yarnpkg/plugin-workspace-tools</code></li><li>使用 <code>yarn workspaces foreach</code> 在所有模块执行命令</li></ol><p>下面是在所有模块中按照依赖顺序尽可能地并行构建包</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> workspaces foreach -p --topological-dev run build
<span class="token comment"># 或删除所有 dist</span>
<span class="token function">yarn</span> workspaces foreach -p <span class="token builtin class-name">exec</span> rimraf dist
<span class="token comment"># 如果希望删除 node_modules，则需要使用 yarn dlx</span>
<span class="token function">yarn</span> workspaces foreach -p <span class="token builtin class-name">exec</span> <span class="token function">yarn</span> dlx rimraf node_modules
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="如何像-lerna-publish-更新所有模块的版本" tabindex="-1"><a class="header-anchor" href="#如何像-lerna-publish-更新所有模块的版本" aria-hidden="true">#</a> 如何像 lerna publish 更新所有模块的版本</h2><p>升级全部模块目前可以使用 <code>yarn workspaces foreach</code> 模拟 <code>lerna publish</code>，但对于独立模式则是另外一套完全不同的模式了。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> workspaces foreach <span class="token builtin class-name">exec</span> <span class="token function">yarn</span> version patch
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>缺点是无法按照是否修改决定是否发布新版本。。。</p><p>发布所有包</p><blockquote><p><code>yarn npm publish</code> 仍有 bug，所以只能直接 <code>npm publish</code> 了</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> workspaces foreach -A --no-private <span class="token builtin class-name">exec</span> <span class="token function">npm</span> publish
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>感觉还是需要实现缓存的功能，只是将缓存文件加到 git 而已。考虑到不是所有命令都需要，也许可以使用缓存目录。</p></blockquote><h2 id="如果包含-cli-子模块怎么办" tabindex="-1"><a class="header-anchor" href="#如果包含-cli-子模块怎么办" aria-hidden="true">#</a> 如果包含 cli 子模块怎么办？</h2><p>打包完成之后 <code>yarn</code> 安装即可，yarn 会负责将命令写入到依赖的其他子模块的 <em>node_modules/.bin/</em> 中。</p><h2 id="编写插件" tabindex="-1"><a class="header-anchor" href="#编写插件" aria-hidden="true">#</a> 编写插件</h2><blockquote><p><a href="https://yarnpkg.com/advanced/plugin-tutorial" target="_blank" rel="noopener noreferrer">插件教程文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p><img src="/assets/cf84da80c9d143cdb4163cc7a1d34fb4.0c729548.svg" alt="monorepo 构建.drawio.svg"></p><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题" aria-hidden="true">#</a> 问题</h2><ul><li>不能使用 lerna 那种拼接脚本的方式，即将 <code>lerna run --include-dependencies --stream</code> 放在 <code>stream</code> 脚本，然后使用 <code>yarn stream &lt;cmd&gt;</code> 拼接命令的形式。</li><li>不确定 yarn 是否包含 <code>lerna publish</code> 那种自动检测和批量发布的命令 -- 支持不太好用</li><li>不确定 yarn 是否有类似于 <code>rush/nx</code> 的构建缓存功能 -- 没有原生支持，两个插件也都有各自的问题</li><li>概念太多实在太麻烦了，各种奇怪的问题 <ul><li><code>yarn npm publish</code> 会说权限错误，但实际上 <code>yarn npm login</code> 已经成功了，文档上说可以配置 <code>npmAuthToken</code>，但这是不合理的（将 token 加到 git 管理中）</li><li><code>yarn workspaces foreach exec yarn jest --all</code> 会报一个错误</li></ul></li><li>对于 yarn2 pnp，目前 webstorm 仍然只有非常基本的支持，包括 prettier/jest 都存在问题，参考：<a href="https://youtrack.jetbrains.com/issue/WEB-35034" target="_blank" rel="noopener noreferrer">https://youtrack.jetbrains.com/issue/WEB-35034<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li>yarn 2 的社区接受度似乎极低，github 上依赖它的库不超过 100 个，参考：<a href="https://github.com/yarnpkg/berry/network/dependents?package_id=UGFja2FnZS03MDE5NDg3MjU%3D" target="_blank" rel="noopener noreferrer">https://github.com/yarnpkg/berry/network/dependents?package_id=UGFja2FnZS03MDE5NDg3MjU%3D<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> -- 实际上这是错的，由于 yarn2 不在 package.json 中声明而已，目前 storybook 等流行库也升级了 yarn2，但它们也混用 lerna 和 nx。。。</li><li>无法使用 <code>patch-package</code>，但可以使用 <code>yarn patch</code> 命令。。。</li></ul><h2 id="其他优点" tabindex="-1"><a class="header-anchor" href="#其他优点" aria-hidden="true">#</a> 其他优点</h2><ul><li>原生支持 workspaces</li><li>有插件 api，可以为自定义需求编写插件</li><li>cli 命令执行不再强绑定到 <em>node_modules/.bin</em></li><li>重新安装依赖时时不需要停止 <code>vite dev</code>（目前无法安装成功）</li></ul><h2 id="编写插件之后应该怎么在本地测试" tabindex="-1"><a class="header-anchor" href="#编写插件之后应该怎么在本地测试" aria-hidden="true">#</a> 编写插件之后应该怎么在本地测试？</h2><ol><li><p>单元测试</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> dir <span class="token operator">=</span> npath<span class="token punctuation">.</span><span class="token function">toPortablePath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> configuration <span class="token operator">=</span> <span class="token keyword">await</span> Configuration<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> Project<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>project<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>yarn plugin import &lt;&gt;</code></p></li></ol><h2 id="yarn-workspace-有办法包含一个不在-workspace-管理的子目录么" tabindex="-1"><a class="header-anchor" href="#yarn-workspace-有办法包含一个不在-workspace-管理的子目录么" aria-hidden="true">#</a> yarn workspace 有办法包含一个不在 workspace 管理的子目录么？</h2><p>例如项目可能有一个 website 目录用以存放网站的文档，而又不希望将之放到 yarn workspace 管理（有可能是不同的技术栈，例如 vuepress）。</p><p>在 <code>workspace</code> 字段中排除，然后在目录中添加空的 <code>yarn.lock</code> 文件</p><h2 id="npmrc-yarnrc-yml" tabindex="-1"><a class="header-anchor" href="#npmrc-yarnrc-yml" aria-hidden="true">#</a> npmrc =&gt; yarnrc.yml</h2><h2 id="yarn2-在-monorepo-中根模块无法直接-import-子模块的-yarn-插件" tabindex="-1"><a class="header-anchor" href="#yarn2-在-monorepo-中根模块无法直接-import-子模块的-yarn-插件" aria-hidden="true">#</a> yarn2 在 monorepo 中根模块无法直接 import 子模块的 yarn 插件</h2><blockquote><p><a href="https://github.com/rxliuli/liuli-tools" target="_blank" rel="noopener noreferrer">复现仓库<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p>复现步骤</p><ol><li><code>yarn &amp;&amp; yarn setup</code> 安装依赖及初始化</li><li><code>cd libs/yarn-plugin-changed &amp;&amp; yarn build</code> 打包插件</li><li><code>cd ../.. &amp;&amp; yarn plugin import libs/yarn-plugin-changed/bundles/\@yarnpkg/plugin-changed.js</code> 回到根目录安装插件</li><li>得到错误</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>$ yarn plugin <span class="token keyword">import</span> libs<span class="token operator">/</span>yarn<span class="token operator">-</span>plugin<span class="token operator">-</span>changed<span class="token operator">/</span>bundles<span class="token operator">/</span>\@yarnpkg<span class="token operator">/</span>plugin<span class="token operator">-</span>changed<span class="token punctuation">.</span>js
➤ <span class="token constant">YN0001</span><span class="token operator">:</span> Error<span class="token operator">:</span> Invalid <span class="token function">locator</span> <span class="token punctuation">(</span>@yarnpkg<span class="token operator">/</span>plugin<span class="token operator">-</span>libs<span class="token operator">/</span>yarn<span class="token operator">-</span>plugin<span class="token operator">-</span>changed<span class="token operator">/</span>bundles<span class="token operator">/</span>@yarnpkg<span class="token operator">/</span>plugin<span class="token operator">-</span>changed<span class="token punctuation">.</span>js<span class="token punctuation">)</span>
    at Object<span class="token punctuation">.</span><span class="token function">hA</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">242</span><span class="token operator">:</span><span class="token number">12395</span><span class="token punctuation">)</span>
    at <span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">387</span><span class="token operator">:</span><span class="token number">1702</span>
    at <span class="token keyword">async</span> Function<span class="token punctuation">.</span><span class="token function">start</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">275</span><span class="token operator">:</span><span class="token number">2287</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> Rp<span class="token punctuation">.</span><span class="token function">execute</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">387</span><span class="token operator">:</span><span class="token number">1110</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> Rp<span class="token punctuation">.</span><span class="token function">validateAndExecute</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">197</span><span class="token operator">:</span><span class="token number">620</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> ts<span class="token punctuation">.</span><span class="token function">run</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">211</span><span class="token operator">:</span><span class="token number">1846</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> ts<span class="token punctuation">.</span><span class="token function">runExit</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">211</span><span class="token operator">:</span><span class="token number">2013</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> <span class="token function">i</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">310</span><span class="token operator">:</span><span class="token number">12327</span><span class="token punctuation">)</span>
    at <span class="token keyword">async</span> <span class="token function">r</span> <span class="token punctuation">(</span><span class="token constant">C</span><span class="token operator">:</span>\Users\rxliuli\Code\Pkg\liuli<span class="token operator">-</span>tools\<span class="token punctuation">.</span>yarn\releases\yarn<span class="token operator">-</span>berry<span class="token punctuation">.</span>cjs<span class="token operator">:</span><span class="token number">310</span><span class="token operator">:</span><span class="token number">10567</span><span class="token punctuation">)</span>
➤ <span class="token constant">YN0000</span><span class="token operator">:</span> Failed <span class="token keyword">with</span> errors <span class="token keyword">in</span> <span class="token number">0</span>s <span class="token number">133</span>ms
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>答案</p><p>必须使用 . 开头的相对路径</p><blockquote><p><a href="https://github.com/yarnpkg/berry/issues/3331#issuecomment-903615924" target="_blank" rel="noopener noreferrer">github issue<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><h2 id="yarn-插件打包后在-bundles-yarnpkg-下而非我们的组织名下面" tabindex="-1"><a class="header-anchor" href="#yarn-插件打包后在-bundles-yarnpkg-下而非我们的组织名下面" aria-hidden="true">#</a> yarn 插件打包后在 bundles/@yarnpkg 下而非我们的组织名下面</h2><p>同样是在编写 yarn 插件时遇到的错误，在我们使用 yarn plugin import 安装插件之后，才发现安装的目录是 <em>.yarn/plugins/@yarnpkg/plugin-changed.cjs</em>，这似乎有些不对，因为我们的项目名是 <code>@liuli-util/yarn-plugin-changed</code>。还是我遗漏了什么配置？</p><p>复现步骤</p><p>现有的包是怎么做的？</p><ul><li><a href="https://github.com/ojkelly/yarn.build/blob/trunk/packages/plugins/plugin-build/package.json#L46-L47" target="_blank" rel="noopener noreferrer">yarn.build<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>: 使用系统命令手动移动文件，同时替换打包之后的 name 字段</li></ul><p>答案</p><p>是 bundler 刻意的行为，无法直接改变。。。</p><h2 id="获取系统信息" tabindex="-1"><a class="header-anchor" href="#获取系统信息" aria-hidden="true">#</a> 获取系统信息</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>npx envinfo --preset jest
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="使用-yarn-patch-制作本地补丁包" tabindex="-1"><a class="header-anchor" href="#使用-yarn-patch-制作本地补丁包" aria-hidden="true">#</a> 使用 yarn patch 制作本地补丁包</h2><blockquote><p><a href="https://yarnpkg.com/cli/patch" target="_blank" rel="noopener noreferrer">官方文档 yarn patch<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p>动机</p><p>主要是处理一些 npm 模块可能存在小问题但又来不及提 PR 的情况下，在本地修改并生成 git patch 文件，在每次 <code>yarn install</code> 时合并这些 patch。</p><p>使用步骤</p><ol><li>使用 <code>yarn patch winbox</code> 生成临时目录</li><li>修改目录中的文件</li><li>提交修改并生成 patch <code>yarn patch-commit &quot;C:\Users\rxliuli\AppData\Local\Temp\xfs-f35b52d4\user&quot; -s</code>，保存位置在 <em>.yarn/patches/</em></li><li>修改 package.json 使用 patch 协议 <code>{ &quot;winbox&quot;: &quot;patch:winbox@0.2.0#../../../.yarn/patches/winbox-npm-0.2.0-8ddb0784dd&quot; }</code></li><li>重新安装依赖 <code>yarn</code></li></ol><blockquote><p>patch-package 目前无法在 yarn2 workspaces 下正常使用，参考：<a href="https://github.com/ds300/patch-package/issues/132" target="_blank" rel="noopener noreferrer">https://github.com/ds300/patch-package/issues/132<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><h2 id="yarn-pack-会忽略-gitignore" tabindex="-1"><a class="header-anchor" href="#yarn-pack-会忽略-gitignore" aria-hidden="true">#</a> yarn pack 会忽略 .gitignore</h2><blockquote><p>官方将之写死到代码里了，参考: <a href="https://github.com/yarnpkg/berry/blob/7ae458b8165ad53a8ef9db0060cbb6de73305768/packages/plugin-pack/sources/packUtils.ts#L26-L39" target="_blank" rel="noopener noreferrer">https://github.com/yarnpkg/berry/blob/7ae458b8165ad53a8ef9db0060cbb6de73305768/packages/plugin-pack/sources/packUtils.ts#L26-L39<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p>是的，yarn pack 永远会忽略它，如果需要，可能需要将之打包到 js 代码里，然后在 postinstall 时写入文件（虽然会炸掉 yarn2 pnp 模式就是了）</p><h2 id="运行初始化命令但卡死了" tabindex="-1"><a class="header-anchor" href="#运行初始化命令但卡死了" aria-hidden="true">#</a> 运行初始化命令但卡死了</h2><p>可能会报下面这个错</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>The <span class="token builtin class-name">command</span> failed <span class="token keyword">for</span> workspaces that are depended upon by other workspaces<span class="token punctuation">;</span> can&#39;t satisfy the dependency graph
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>检查运行的命令中是否包含递归调用，即在 <code>setup</code> 命令中调用了 <code>setup</code> 命令</p><blockquote><p>需要开发类似 yarn.build 的 cli，可以更好的看到到底是哪个模块运行命令卡住了，可以统计一共用了多长时间。</p></blockquote><h2 id="如何更新所有依赖的版本为最新" tabindex="-1"><a class="header-anchor" href="#如何更新所有依赖的版本为最新" aria-hidden="true">#</a> 如何更新所有依赖的版本为最新</h2><p>众所周知，yarn1 提供了 <code>yarn ugprade --latest</code> 来更新所有版本至最新，但 yarn2 不存在这个命令，唯一的官方插件 <a href="https://yarnpkg.com/cli/upgrade-interactive" target="_blank" rel="noopener noreferrer">upgrade-interactive<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 是需要在交互式 cli 中选择，而且还在使用代理时存在 bug。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> dlx npm-check-updates -u <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="yarn-插件没有版本的概念" tabindex="-1"><a class="header-anchor" href="#yarn-插件没有版本的概念" aria-hidden="true">#</a> yarn 插件没有版本的概念</h2><p>例如现在当我的 yarn 版本是 2，引入 workspaces 插件就会报错。。。它总会下载最新版本的插件</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Usage Error: This plugin cannot access the package referenced via typanion <span class="token function">which</span> is neither a builtin, nor an exposed entry <span class="token punctuation">(</span>when initializing @yarnpkg/plugin-workspace-tools, defined <span class="token keyword">in</span> /C:/Users/rxliuli/Code/Web/demo/yarn2-error/.yarnrc.yml<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="yarn-workspaces-的-topological-dev-参数未生效" tabindex="-1"><a class="header-anchor" href="#yarn-workspaces-的-topological-dev-参数未生效" aria-hidden="true">#</a> yarn workspaces 的 <code>--topological-dev</code> 参数未生效</h2><blockquote><p><a href="https://github.com/rxliuli/yarn2-workspaces-error" target="_blank" rel="noopener noreferrer">示例 github 仓库<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p>当我使用 <code>--topological-dev</code> 参数时，它并不会正常按照依赖顺序运行</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> workspaces foreach -v -p --topological-dev run setup
➤ YN0000: <span class="token punctuation">[</span>a<span class="token punctuation">]</span>: Process started
➤ YN0000: <span class="token punctuation">[</span>b<span class="token punctuation">]</span>: Process started
➤ YN0000: <span class="token punctuation">[</span>a<span class="token punctuation">]</span>: a
➤ YN0000: <span class="token punctuation">[</span>a<span class="token punctuation">]</span>: Process exited <span class="token punctuation">(</span>exit code <span class="token number">0</span><span class="token punctuation">)</span>, completed <span class="token keyword">in</span> 0s 88ms
➤ YN0000: <span class="token punctuation">[</span>b<span class="token punctuation">]</span>: b
➤ YN0000: <span class="token punctuation">[</span>b<span class="token punctuation">]</span>: Process exited <span class="token punctuation">(</span>exit code <span class="token number">0</span><span class="token punctuation">)</span>, completed <span class="token keyword">in</span> 0s 82ms
➤ YN0000: Done <span class="token keyword">in</span> 0s 101ms
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这似乎是一个回归错误，只有 yarn3 才会出现，目前无法使用 yarn2 安装 workspaces 插件，这是另一个错误。</p><p>复现步骤</p><ol><li><code>git clone https://github.com/rxliuli/yarn2-workspaces-error.git</code></li><li><code>cd yarn2-workspaces-error</code></li><li><code>yarn</code></li><li><code>yarn workspaces foreach -v -p --topological-dev run setup</code></li></ol><blockquote><p><a href="https://github.com/yarnpkg/berry/issues/3475" target="_blank" rel="noopener noreferrer">github issue<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><h2 id="yarn-install-link-step-很慢" tabindex="-1"><a class="header-anchor" href="#yarn-install-link-step-很慢" aria-hidden="true">#</a> yarn install link step 很慢</h2><p>在没有任何变化的情况使用 yarn 重新安装依赖仍然要很久，我不确定发生了什么，我们有 30 个模块，还包含嵌套的 workspace。</p><p>下面是输出</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>➤ YN0000: │ Some peer dependencies are incorrectly met<span class="token punctuation">;</span> run <span class="token function">yarn</span> explain peer-requirements <span class="token operator">&lt;</span>hash<span class="token operator">&gt;</span> <span class="token keyword">for</span> details, where <span class="token operator">&lt;</span>hash<span class="token operator">&gt;</span> is the six-letter p-prefixed code
➤ YN0000: └ Completed <span class="token keyword">in</span> 0s 480ms
➤ YN0000: ┌ Fetch step
➤ YN0000: └ Completed <span class="token keyword">in</span> 2s 765ms
➤ YN0000: ┌ Link step
➤ YN0062: │ fsevents@patch:fsevents@npm%3A2.3.2<span class="token comment">#~builtin&lt;compat/fsevents&gt;::version=2.3.2&amp;hash=1cc4b2 The platform win32 is incompatible with this module, link skipped.</span>
➤ YN0062: │ fsevents@patch:fsevents@npm%3A1.2.13<span class="token comment">#~builtin&lt;compat/fsevents&gt;::version=1.2.13&amp;hash=1cc4b2 The platform win32 is incompatible with this module, link skipped.</span>
➤ YN0000: └ Completed <span class="token keyword">in</span> 38s 348ms
➤ YN0000: Done with warnings <span class="token keyword">in</span> 41s 807ms
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p><a href="https://github.com/yarnpkg/berry/issues/3476" target="_blank" rel="noopener noreferrer">github issue<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><p>看起来像是因为嵌套 workspace 引起的，有一个 PR 正在尝试修复这个问题。</p><h2 id="如何在-monorepo-中执行指定脚本" tabindex="-1"><a class="header-anchor" href="#如何在-monorepo-中执行指定脚本" aria-hidden="true">#</a> 如何在 monorepo 中执行指定脚本</h2><p>有时候想在所有模块运行脚本做一些批量迁移的工作</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i -g esno
<span class="token function">yarn</span> workspaces foreach -pvA <span class="token builtin class-name">exec</span> <span class="token string">&quot;esno &lt;脚本绝对路径&gt;&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="yarn-如何全局安装-monorepo-项目中包含私有模块依赖的-cli-模块" tabindex="-1"><a class="header-anchor" href="#yarn-如何全局安装-monorepo-项目中包含私有模块依赖的-cli-模块" aria-hidden="true">#</a> yarn 如何全局安装 monorepo 项目中包含私有模块依赖的 cli 模块</h2><ol><li>将所有的私有模块移至 <code>devDependencies</code></li><li>使用 esbuild 等工具将所有依赖打包到 bundle</li><li><code>npm i -g .</code> 安装依赖即可</li><li>全局使用命令</li></ol><p>这里的核心问题是全局安装依赖时无法找到 monorepo 中未发布的模块，但私有模块在全局找不到，也无法作为依赖安装，所以只能使用这种奇怪的方法了。另一种解决方案是递归将所依赖的私有模块全部全局安装（没有尝试过）。</p><h2 id="nodejs-性能是否真的很烂" tabindex="-1"><a class="header-anchor" href="#nodejs-性能是否真的很烂" aria-hidden="true">#</a> nodejs 性能是否真的很烂</h2><p>esbuild cli</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">time</span> esbuild src/bin.ts --bundle --external:esbuild --external:@yarnpkg/cli --platform<span class="token operator">=</span>node --outfile<span class="token operator">=</span>dist/bin.js --sourcemap <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
<span class="token function">time</span> esbuild src/index.ts --bundle --external:esbuild --external:@yarnpkg/cli --external:fs-extra --platform<span class="token operator">=</span>node --format<span class="token operator">=</span>cjs --outfile<span class="token operator">=</span>dist/index.js --sourcemap <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
<span class="token function">time</span> esbuild src/index.ts --bundle --external:esbuild --external:@yarnpkg/cli --external:fs-extra --platform<span class="token operator">=</span>node --format<span class="token operator">=</span>esm --outfile<span class="token operator">=</span>dist/index.esm.js --sourcemap
<span class="token comment"># 0m0.244s # 15ms</span>
<span class="token comment"># 0m0.211s # 4ms</span>
<span class="token comment"># 0m0.212s # 4ms</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>esbuild base nodejs cli</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">time</span> liuli-cli build cli <span class="token comment"># 0m2.276s # 1988ms</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>结论：真的很烂，数量级上的差距</p></blockquote><p>generate 替换 readme 名字有问题，会替换掉 #，不会替换 cli/lib</p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/p/d9b7ea8e049b42628164019b16f762d2.html" class="nav-link" aria-label="lerna 使用踩坑"><!--[--><!--]--> lerna 使用踩坑 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.55fed6f8.js" defer></script>
  </body>
</html>
