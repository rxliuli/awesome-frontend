<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>历史 | Awesome Frontend</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="这是一个自以为是的前端技术选择和推荐网站">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.b155fad5.js" as="script"><link rel="preload" href="/assets/js/2.4e7b4bc6.js" as="script"><link rel="preload" href="/assets/js/12.26a8ad12.js" as="script"><link rel="prefetch" href="/assets/js/10.6fe0f569.js"><link rel="prefetch" href="/assets/js/11.05b6edf4.js"><link rel="prefetch" href="/assets/js/13.30df2a62.js"><link rel="prefetch" href="/assets/js/14.6ea38a68.js"><link rel="prefetch" href="/assets/js/15.f96dbde9.js"><link rel="prefetch" href="/assets/js/16.11d9642b.js"><link rel="prefetch" href="/assets/js/17.21e38c9f.js"><link rel="prefetch" href="/assets/js/18.4b18a446.js"><link rel="prefetch" href="/assets/js/19.bc99a09d.js"><link rel="prefetch" href="/assets/js/20.de4b1e9e.js"><link rel="prefetch" href="/assets/js/21.2dff968c.js"><link rel="prefetch" href="/assets/js/22.6ca58d91.js"><link rel="prefetch" href="/assets/js/23.89a09981.js"><link rel="prefetch" href="/assets/js/24.750e92d6.js"><link rel="prefetch" href="/assets/js/25.6d5f17ec.js"><link rel="prefetch" href="/assets/js/26.339fca69.js"><link rel="prefetch" href="/assets/js/27.2e2dc84d.js"><link rel="prefetch" href="/assets/js/28.f41385ef.js"><link rel="prefetch" href="/assets/js/29.300f52fe.js"><link rel="prefetch" href="/assets/js/3.68c5bbe3.js"><link rel="prefetch" href="/assets/js/30.459c69ec.js"><link rel="prefetch" href="/assets/js/31.154fe602.js"><link rel="prefetch" href="/assets/js/32.cc024fe0.js"><link rel="prefetch" href="/assets/js/33.5bc81e4f.js"><link rel="prefetch" href="/assets/js/34.c36f3957.js"><link rel="prefetch" href="/assets/js/35.42d69eb1.js"><link rel="prefetch" href="/assets/js/36.85867023.js"><link rel="prefetch" href="/assets/js/37.2a59d5b2.js"><link rel="prefetch" href="/assets/js/38.f4cbdd25.js"><link rel="prefetch" href="/assets/js/39.78e3dfeb.js"><link rel="prefetch" href="/assets/js/4.3c56bbfe.js"><link rel="prefetch" href="/assets/js/40.016ba148.js"><link rel="prefetch" href="/assets/js/41.a09c5bd3.js"><link rel="prefetch" href="/assets/js/42.1cbb7385.js"><link rel="prefetch" href="/assets/js/43.3d84b222.js"><link rel="prefetch" href="/assets/js/44.88b77d20.js"><link rel="prefetch" href="/assets/js/5.9b4f1e5f.js"><link rel="prefetch" href="/assets/js/6.30ce0fea.js"><link rel="prefetch" href="/assets/js/7.d51e4a8f.js"><link rel="prefetch" href="/assets/js/8.1023dcd0.js"><link rel="prefetch" href="/assets/js/9.fdb07cd9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Awesome Frontend</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/rxliuli/wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/rxliuli/wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/p/b8a95af9134a488e9d94463bd18768c9.html" class="sidebar-link">编写兼容 nodejs/浏览器的库</a></li><li><a href="/p/0171bcd51b1343d6a9ad54557d567c46.html" class="sidebar-link">在现代前端项目中使用 Worker</a></li><li><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html" aria-current="page" class="active sidebar-link">实践 lerna monorepo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#历史" class="sidebar-link">历史</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#为什么需要-monorepo" class="sidebar-link">为什么需要 monorepo？</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#为什么选择-lerna" class="sidebar-link">为什么选择 lerna？</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#lerna-是什么" class="sidebar-link">lerna 是什么？</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#使用-lerna-的优点" class="sidebar-link">使用 lerna 的优点</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#其他" class="sidebar-link">其他</a></li><li class="sidebar-sub-header"><a href="/p/1a6dda43a5a84e61b4b16865d8e52373.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/p/6be33848912b4a63bd0bfebe0e99fda1.html" class="sidebar-link">React 根据状态动态化功能的一些思考</a></li><li><a href="/p/d984e195f1b1469ca49ff364374ce3d8.html" class="sidebar-link">关于前端组件通信的一些理解</a></li><li><a href="/p/3b1502f22ad645b5a6521b39b145e560.html" class="sidebar-link">使用 React Context 结合 EventEmitter</a></li><li><a href="/p/7b0fe35b00b345618a9323977a2e552a.html" class="sidebar-link">使用 gh-pages 发布前端项目</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="历史"><a href="#历史" class="header-anchor">#</a> 历史</h2> <ul><li>上古时期，前端没有工程化的概念可言，复用代码也不过是将某些 css、js 代码片段保存到笔记，需要时复制到项目中，仅此而已。参考：<a href="https://github.com/Wscats/CV/issues/29" target="_blank" rel="noopener noreferrer">55 个提高你 CSS 开发效率的必备片段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，或是 <a href="http://www.htmleaf.com/jQuery/" target="_blank" rel="noopener noreferrer">jquery 库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>莽荒时代，前端出现了 nodejs 和 npm，于是一大批通用代码被发布到了 npm 平台，可以在项目中简单配置即可使用通用的库，任何人都可以简单的将代码发布到 npm。参考：<a href="https://www.npmjs.com/package/lodash" target="_blank" rel="noopener noreferrer">lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>现代，由于前端项目的复杂度逐渐上升，所以出现了 monorepo 工具以更简单的复用代码。例如层出不穷的 monorepo 支持工具 <a href="https://lerna.js.org/" target="_blank" rel="noopener noreferrer">lerna<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://rushjs.io/" target="_blank" rel="noopener noreferrer">@microsoft/rush<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://yarnpkg.com/features/workspaces" target="_blank" rel="noopener noreferrer">yarn 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://pnpm.js.org/en/workspaces" target="_blank" rel="noopener noreferrer">pnpm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://docs.npmjs.com/cli/v7/using-npm/workspaces" target="_blank" rel="noopener noreferrer">npm 7<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>自去年 10 月开始，吾辈使用 lerna 重构个人和公司的项目，以应对愈加复杂的前端项目。</p></blockquote> <h2 id="为什么需要-monorepo"><a href="#为什么需要-monorepo" class="header-anchor">#</a> 为什么需要 monorepo？</h2> <blockquote><p>借用一下 lerna 官网的简介：</p> <p>将大型代码仓库分割成多个独立版本化的 软件包（package）对于代码共享来说非常有用。但是，如果某些更改 跨越了多个代码仓库的话将变得很 麻烦 并且难以跟踪，并且， 跨越多个代码仓库的测试将迅速变得非常复杂。</p> <p>为了解决这些（以及许多其它）问题，某些项目会将 代码仓库分割成多个软件包（package），并将每个软件包存放到独立的代码仓库中。但是，例如 Babel、 React、Angular、Ember、Meteor、Jest 等项目以及许多其他项目则是在 一个代码仓库中包含了多个软件包（package）并进行开发。</p></blockquote> <p>你可能会认为除了大型开源项目之外，monorepo 对于小型项目和生产环境的业务项目没有太多价值。但这是错的，前者我在微型工具库 <a href="https://github.com/rxliuli/liuli-util" target="_blank" rel="noopener noreferrer">liuli-util<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上进行了实践，确定了它对于维护和使用确实有帮助。而后者，甚至出现了专门为业务项目的 monorepo 工具 <a href="https://rushjs.io/pages/intro/why_mono/" target="_blank" rel="noopener noreferrer">@microsoft/rush<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，微软在 <a href="https://github.com/microsoft/rushstack" target="_blank" rel="noopener noreferrer">rushstack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 项目中大规模使用了它。</p> <h2 id="为什么选择-lerna"><a href="#为什么选择-lerna" class="header-anchor">#</a> 为什么选择 lerna？</h2> <p>那么，有了这么多 monorepo 工具，为什么我们选择 lerna？</p> <ul><li><a href="https://lerna.js.org/" target="_blank" rel="noopener noreferrer">lerna<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rushjs.io/" target="_blank" rel="noopener noreferrer">@microsoft/rush<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://yarnpkg.com/features/workspaces" target="_blank" rel="noopener noreferrer">yarn 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://pnpm.js.org/en/workspaces" target="_blank" rel="noopener noreferrer">pnpm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.npmjs.com/cli/v7/using-npm/workspaces" target="_blank" rel="noopener noreferrer">npm 7<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>其实，除了 lerna 与 @microsoft/rush 之外，其它竞争对手都是包管理器，仅仅只是提供了 workspace 的工作空间，并未提供更高级功能。</p> <blockquote><p>lerna 和 @microsoft/rush 的 npm 趋势对比参考: <a href="https://www.npmtrends.com/lerna-vs-@microsoft/rush" target="_blank" rel="noopener noreferrer">https://www.npmtrends.com/lerna-vs-@microsoft/rush<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>下图是一个对比</p> <table><thead><tr><th>对比项</th> <th>lerna</th> <th>@microsoft/rush</th></tr></thead> <tbody><tr><td>star</td> <td>26,824</td> <td>2,392</td></tr> <tr><td>周下载</td> <td>1,155,241</td> <td>100,386</td></tr> <tr><td>使用者</td> <td>知名开源项目</td> <td>微软系产品</td></tr></tbody></table> <p>就吾辈的实际使用体验而言，相比于 lerna，rush 默认包含了更多的东西，而非通过组合一系列可选的工具支持，这增长了相当的门槛。</p> <p>下面是吾辈对其的一些认知过程</p> <ul><li>rush.js 是真的感觉很【专业】，限定了很多很多东西</li> <li><a href="https://rushjs.io/pages/maintainer/setup_policies/" target="_blank" rel="noopener noreferrer">https://rushjs.io/pages/maintainer/setup_policies/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>像是这里，通过 allowedPackagesPolicy 的方式对 team 中所有开发人员都可以直接引入新的 npm 包做出了限制</li> <li>唉，rush 比 lerna 复杂多了，做了很多很多的预定义的事情，这就意味着，它对项目维护者（而非开发者）的要求更高</li> <li>和 ide 没完全集成真痛苦.JPG</li> <li>吾辈总算明白这些配置为什么是【推荐配置】而不是【默认配置】了，引发的错误太多了（毕竟 npm 包很多并不规范）</li> <li>rush monorepo 的一个问题是，某些包总喜欢强制指定依赖包的特定版本（例如 react-scripts），而 rush 总是“聪明”的仅安装最新的，导致添加的项目莫名其妙的炸掉</li> <li>吾辈的锅，它在最后给了方法 <a href="https://rushjs.io/pages/advanced/installation_variants/" target="_blank" rel="noopener noreferrer">https://rushjs.io/pages/advanced/installation_variants/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>但一整个进阶主题都是在处理这个问题。。。</li> <li>算了，吾辈放弃了，rush + pnpm 感觉上维护配置成本太高了，滚回 lerna + yarn 了</li></ul> <blockquote><p>rush 在功能、目标和文档方面更好，但现阶段而言还是 lerna 更成熟。</p></blockquote> <h2 id="lerna-是什么"><a href="#lerna-是什么" class="header-anchor">#</a> lerna 是什么？</h2> <p>简而言之，Lerna 是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目。可以在一个项目中创建多个模块（基本上模块也可以认为是一个项目），并且可以在本地的模块之间互相关联。</p> <p>lerna 项目的基本结构如下</p> <p>生产项目</p> <ul><li>根目录
<ul><li><code>apps</code>: 生产项目
<ul><li><code>app-1</code></li> <li><code>app-2</code></li></ul></li> <li><code>libs</code>: 通用模块
<ul><li><code>lib-1</code></li> <li><code>lib-2</code></li></ul></li> <li><code>package.json</code></li> <li><code>lerna.json</code></li></ul></li></ul> <p>开源库</p> <ul><li>根目录
<ul><li><code>libs</code>: 模块根目录
<ul><li><code>lib-1</code></li> <li><code>lib-2</code></li></ul></li> <li><code>package.json</code></li> <li><code>lerna.json</code></li></ul></li></ul> <blockquote><p>目录的名字灵感来源于 <a href="https://github.com/microsoft/rushstack" target="_blank" rel="noopener noreferrer">rushstack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="使用-lerna-的优点"><a href="#使用-lerna-的优点" class="header-anchor">#</a> 使用 lerna 的优点</h2> <blockquote><p>其中部分优点是 monorepo 固有的优势，但也有 lerna 独有的功能。</p></blockquote> <ul><li>更容易抽离公共代码: 模块之间可以互相引用并且即时生效</li> <li>更容易统一
<ul><li>项目配置: <code>tsconfig.json/prettier.json/git hooks</code></li> <li>管理和发布一系列包: <code>lerna publish</code></li> <li>修改依赖立刻生效: <code>lerna bootstrap</code></li> <li>依赖版本: 和默认合并不同版本的依赖</li> <li>文档生成和合并: <code>fliegdoc</code></li> <li>代码风格: <code>prettier/git hooks</code></li> <li>在一个模块运行另一个模块的命令: <code>lerna run &lt;cmd&gt; --scope &lt;pkg&gt;</code></li> <li>打包工具和流程: 封装更适合项目的打包 cli</li></ul></li></ul> <p>目前稍微大点的开源项目不是已经转为了 lerna monorepo，就是已经在转换的路上（很像最近流行的使用 typescript 重构库）。包括但不限于以下这些：</p> <p><img src="/assets/img/1481553a70764d679f18841199b9db09.46bc3292.png" alt="1614158368615"></p> <blockquote><p>吾辈目前使用的笔记工具 Joplin 也在去年使用 lerna 重构了，参考：<a href="https://github.com/laurent22/joplin/pull/4039" target="_blank" rel="noopener noreferrer">Lerna migration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="根据依赖图并行运行-npm-命令"><a href="#根据依赖图并行运行-npm-命令" class="header-anchor">#</a> 根据依赖图并行运行 npm 命令</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>lerna run <span class="token operator">&lt;</span>npm script<span class="token operator">&gt;</span> --include-dependencies --stream
</code></pre></div><blockquote><p>参考: <a href="https://github.com/lerna/lerna/blob/main/commands/run/README.md#--stream" target="_blank" rel="noopener noreferrer">--stream<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/lerna/lerna/blob/main/core/filter-options/README.md#--include-dependencies" target="_blank" rel="noopener noreferrer">--include-dependencies<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="git-规范"><a href="#git-规范" class="header-anchor">#</a> git 规范</h3> <p>在单体项目中，只需要简单的分为 dev/master 即可开发，但在 monorepo 中，可能存在多个 apps，这种时候，简单的 dev/master 策略便不太好用了，主要原因是</p> <ul><li>dev 包含了所有的开发阶段的代码，所以合并的时候会合并到不希望合并的其他 apps 的修改</li> <li>提交记录看不出来是哪个分支的</li></ul> <blockquote><p>吾辈的个人项目 <a href="https://github.com/rxliuli/joplin-utils" target="_blank" rel="noopener noreferrer">joplin-utils<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 就面临这种问题。</p></blockquote> <p>下面是吾辈的一些想法，目前还正在实践中</p> <ul><li>规范化分支
<ul><li>master: 生产环境分支，任何时候都应该是可部署的</li> <li>dev: 指代正在开发环境进行测试的功能</li> <li><code>feat-*</code>: 正在开发的功能分支</li> <li><code>fix-*</code>: 修复线上 bug 的分支</li></ul></li> <li>规范化流程
<ul><li>分支一定是从 master 拉取</li> <li>分支一定是合并到 dev 测试</li> <li>分支一定是合并到 master 部署生产</li></ul></li> <li>规范化提交信息
<ul><li>基本采用 <a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener noreferrer">commitlint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 控制提交格式，包括 <strong>类型(模块): 提交说明</strong></li></ul></li></ul> <h3 id="模块规范"><a href="#模块规范" class="header-anchor">#</a> 模块规范</h3> <ul><li>目录
<ul><li><code>apps</code>: 最终用户可以使用的程序或 cli</li> <li><code>libs</code>: 一些依赖项，根据需要发布到 npm</li> <li><code>examples</code>: 一些示例项目</li></ul></li> <li>scripts
<ul><li><code>setup</code>: 项目初始化的一些脚本</li> <li><code>dev</code>: 开发阶段运行的脚本</li> <li><code>build</code>: 打包代码</li> <li><code>docs:dev</code>: 启动本地文档预览服务</li> <li><code>docs:build</code>: 将文档捆绑为静态文件</li> <li><code>docs:deploy</code>: 部署文档到线上</li></ul></li></ul> <h3 id="rollup-捆绑-monorepo-仍然存在错误"><a href="#rollup-捆绑-monorepo-仍然存在错误" class="header-anchor">#</a> rollup 捆绑 monorepo 仍然存在错误</h3> <p>目前 rollup + node-resolve 插件捆绑本地依赖时仍然存在一些问题，参考：<a href="https://github.com/rollup/plugins/issues/743" target="_blank" rel="noopener noreferrer">https://github.com/rollup/plugins/issues/743<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，目前的替代方案是 <a href="https://esbuild.github.io/" target="_blank" rel="noopener noreferrer">esbuild<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="有时候会始终无法安装正确的版本"><a href="#有时候会始终无法安装正确的版本" class="header-anchor">#</a> 有时候会始终无法安装正确的版本</h3> <p>例如在 package.json 中声明了依赖</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;rollup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.51.0&quot;</span> <span class="token comment">// 实际安装的可能是 2.50.6</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/019d27e1c9224c39b2214fb943dd3c06.ab34aae5.png" alt="1622999313766"></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>使用 lerna 虽然会增加一些复杂度，但带来的优点仍然是超过缺点的。</p> <blockquote><p>吾辈之所以相信 monorepo 会成为主流的原因是后端已经使用了这么多年的 maven/gradle，如果真的有什么问题，那不会直到现在还在使用。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/p/0171bcd51b1343d6a9ad54557d567c46.html" class="prev">
        在现代前端项目中使用 Worker
      </a></span> <span class="next"><a href="/p/6be33848912b4a63bd0bfebe0e99fda1.html">
        React 根据状态动态化功能的一些思考
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b155fad5.js" defer></script><script src="/assets/js/2.4e7b4bc6.js" defer></script><script src="/assets/js/12.26a8ad12.js" defer></script>
  </body>
</html>
